---
interface Props {
  href?: string;
  className?: string;
  spotlightColor?: string;
}

const {
  href,
  className = '',
  spotlightColor = 'rgba(130, 226, 86, 0.15)'
} = Astro.props;

const Tag = href ? 'a' : 'div';
---

<Tag
  href={href}
  class:list={['spotlight-card group', className]}
  data-spotlight-color={spotlightColor}
>
  <div class="spotlight-overlay"></div>
  <div class="spotlight-content relative z-10">
    <slot />
  </div>
</Tag>

<style>
  .spotlight-card {
    position: relative;
    overflow: hidden;
    background: rgba(31, 41, 55, 0.5);
    padding: 1.5rem;
    border: 1px solid rgba(75, 85, 99, 0.5);
    transition: all 0.3s ease;
    display: block;
    text-decoration: none;
  }

  .spotlight-card:hover {
    border-color: #82e256;
    transform: translateY(-4px) scale(1.02);
  }

  .spotlight-overlay {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    background: var(--spotlight-color, rgba(130, 226, 86, 0.15));
  }

  .spotlight-card:hover .spotlight-overlay {
    opacity: 1;
  }

  .spotlight-content {
    position: relative;
    z-index: 10;
  }
</style>

<script>
  function initSpotlightCards() {
    const cards = document.querySelectorAll('.spotlight-card');

    cards.forEach((card) => {
      const spotlightColor = card.getAttribute('data-spotlight-color') || 'rgba(130, 226, 86, 0.15)';
      (card as HTMLElement).style.setProperty('--spotlight-color', spotlightColor);

      card.addEventListener('mousemove', (e) => {
        const event = e as MouseEvent;
        const rect = card.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;

        (card as HTMLElement).style.setProperty('--mouse-x', `${x}px`);
        (card as HTMLElement).style.setProperty('--mouse-y', `${y}px`);
      });
    });
  }

  // Run on initial load
  initSpotlightCards();

  // Re-run on view transitions (Astro)
  document.addEventListener('astro:after-swap', initSpotlightCards);
</script>

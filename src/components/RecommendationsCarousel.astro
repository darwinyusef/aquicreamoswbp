---
import SpotlightCard from './SpotlightCard.astro';

interface Props {
  title?: string;
  subtitle?: string;
  services: Array<{
    id: number;
    name: string;
    description: string;
    category: string;
    icon: string;
    searchUrl: string;
  }>;
  context?: {
    search?: string;
    category?: string;
  };
}

const {
  title = "Servicios Recomendados Para Ti",
  subtitle = "Basado en tu búsqueda e intereses",
  services = [],
  context = {}
} = Astro.props;

// Generar un ID único para este carrusel
const carouselId = `carousel-${Math.random().toString(36).substr(2, 9)}`;

// Mapear iconos de string a nombres de material symbols
function getIconName(icon: string): string {
  const iconMap: Record<string, string> = {
    layers: 'layers',
    server: 'dns',
    cpu: 'memory',
    eye: 'visibility',
    code2: 'code',
    zap: 'bolt',
    database: 'database',
    docker: 'view_in_ar',
    box: 'inventory_2',
    robot: 'smart_toy',
    wifi: 'wifi',
    broadcast: 'podcasts',
    smartphone: 'smartphone',
    users: 'group',
    activity: 'monitoring',
    gauge: 'speed',
    shield: 'shield',
    table: 'table_chart',
    checkcircle: 'check_circle',
    scan: 'qr_code_scanner',
    linechart: 'show_chart',
    bell: 'notifications',
    folder: 'folder',
    lock: 'lock',
    barchart2: 'bar_chart',
    creditcard: 'credit_card',
    repeat: 'autorenew',
    layers2: 'layers',
    rocket: 'rocket_launch',
    sparkles: 'auto_awesome',
    cloud: 'cloud',
    api: 'api',
  };
  return iconMap[icon] || 'settings';
}
---

{services.length > 0 && (
  <section class="py-8 bg-gradient-to-b from-[#0a0a0a] to-[#1a1a1a]">
    <div class="container mx-auto px-4 md:px-8">
      <div class="max-w-7xl mx-auto">
        <!-- Header con indicador de contexto -->
        <div class="mb-8">
          <div class="mb-4">
            <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">
              {title}
            </h2>
            <p class="text-gray-400">
              {subtitle}
            </p>
          </div>

          <!-- Indicador de contexto si hay búsqueda o categoría -->
          {(context.search || context.category) && (
            <div class="flex flex-wrap gap-2 mb-4">
              {context.search && (
                <span class="inline-flex items-center gap-2 px-3 py-1 bg-[#82e256]/20 text-[#82e256] rounded-full text-sm border border-[#82e256]/30">
                  <span class="material-symbols-outlined text-sm">search</span>
                  <span>Búsqueda: <strong>{context.search}</strong></span>
                </span>
              )}
              {context.category && (
                <span class="inline-flex items-center gap-2 px-3 py-1 bg-[#04ADC0]/20 text-[#04ADC0] rounded-full text-sm border border-[#04ADC0]/30">
                  <span class="material-symbols-outlined text-sm">category</span>
                  <span><strong>{context.category}</strong></span>
                </span>
              )}
            </div>
          )}
        </div>

        <!-- Carrusel Container -->
        <div class="relative group overflow-hidden">
          <!-- Gradiente fade left -->
          <div class="absolute left-0 top-0 bottom-0 w-16 bg-gradient-to-r from-[#1a1a1a] to-transparent z-10 pointer-events-none hidden md:block"></div>

          <!-- Gradiente fade right -->
          <div class="absolute right-0 top-0 bottom-0 w-16 bg-gradient-to-l from-[#1a1a1a] to-transparent z-10 pointer-events-none hidden md:block"></div>

          <!-- Scroll Container -->
          <div
            class={`carousel-scroll-${carouselId} recommendations-looper-track flex gap-6 pb-4`}
          >
            <!-- Primera copia de las cards -->
            {services.map((service) => (
              <div class="flex-shrink-0 w-[280px] md:w-[320px]">
                <a
                  href={service.searchUrl}
                  class="block group/card h-full"
                >
                  <div class="h-full bg-gradient-to-br from-gray-800/30 to-gray-900/30 rounded-xl border border-gray-700 hover:border-[#82e256] transition-all duration-300 overflow-hidden hover:transform hover:scale-105 hover:shadow-2xl hover:shadow-[#82e256]/20">
                    <!-- Header con icono -->
                    <div class="relative bg-gradient-to-br from-[#00464e] to-[#006064] p-6">
                      <div class="flex justify-center">
                        <div class="w-20 h-20 bg-[#82e256]/10 rounded-2xl flex items-center justify-center border border-[#82e256]/30 group-hover/card:bg-[#82e256]/20 group-hover/card:border-[#82e256]/50 transition-all duration-300">
                          <span
                            class="material-symbols-outlined text-[#82e256] transition-transform duration-300 group-hover/card:scale-110"
                            style="font-size: 3rem;"
                          >
                            {getIconName(service.icon)}
                          </span>
                        </div>
                      </div>

                      <!-- Badge de categoría -->
                      <div class="mt-4 text-center">
                        <span class="inline-block text-xs font-semibold text-white/80 bg-black/30 px-3 py-1 rounded-full border border-white/10">
                          {service.category}
                        </span>
                      </div>
                    </div>

                    <!-- Contenido -->
                    <div class="p-6">
                      <h3 class="text-lg font-bold text-white mb-3 line-clamp-2 group-hover/card:text-[#82e256] transition-colors">
                        {service.name}
                      </h3>

                      <p class="text-gray-300 text-sm mb-4 line-clamp-3">
                        {service.description}
                      </p>

                      <!-- CTA -->
                      <div class="flex items-center gap-2 text-[#82e256] text-sm font-semibold group-hover/card:gap-3 transition-all">
                        <span>Explorar servicios</span>
                        <span class="material-symbols-outlined text-sm transition-transform group-hover/card:translate-x-1">
                          search
                        </span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            ))}

            <!-- Segunda copia de las cards para el efecto infinito -->
            {services.map((service) => (
              <div class="flex-shrink-0 w-[280px] md:w-[320px]">
                <a
                  href={service.searchUrl}
                  class="block group/card h-full"
                >
                  <div class="h-full bg-gradient-to-br from-gray-800/30 to-gray-900/30 rounded-xl border border-gray-700 hover:border-[#82e256] transition-all duration-300 overflow-hidden hover:transform hover:scale-105 hover:shadow-2xl hover:shadow-[#82e256]/20">
                    <!-- Header con icono -->
                    <div class="relative bg-gradient-to-br from-[#00464e] to-[#006064] p-6">
                      <div class="flex justify-center">
                        <div class="w-20 h-20 bg-[#82e256]/10 rounded-2xl flex items-center justify-center border border-[#82e256]/30 group-hover/card:bg-[#82e256]/20 group-hover/card:border-[#82e256]/50 transition-all duration-300">
                          <span
                            class="material-symbols-outlined text-[#82e256] transition-transform duration-300 group-hover/card:scale-110"
                            style="font-size: 3rem;"
                          >
                            {getIconName(service.icon)}
                          </span>
                        </div>
                      </div>

                      <!-- Badge de categoría -->
                      <div class="mt-4 text-center">
                        <span class="inline-block text-xs font-semibold text-white/80 bg-black/30 px-3 py-1 rounded-full border border-white/10">
                          {service.category}
                        </span>
                      </div>
                    </div>

                    <!-- Contenido -->
                    <div class="p-6">
                      <h3 class="text-lg font-bold text-white mb-3 line-clamp-2 group-hover/card:text-[#82e256] transition-colors">
                        {service.name}
                      </h3>

                      <p class="text-gray-300 text-sm mb-4 line-clamp-3">
                        {service.description}
                      </p>

                      <!-- CTA -->
                      <div class="flex items-center gap-2 text-[#82e256] text-sm font-semibold group-hover/card:gap-3 transition-all">
                        <span>Explorar servicios</span>
                        <span class="material-symbols-outlined text-sm transition-transform group-hover/card:translate-x-1">
                          search
                        </span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Looper infinito de recomendaciones */
  .recommendations-looper-track {
    animation: recommendations-scroll 20s linear infinite;
    will-change: transform;
  }

  .recommendations-looper-track:hover {
    animation-play-state: paused;
  }

  @keyframes recommendations-scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
</style>

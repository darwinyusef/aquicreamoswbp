---
import Header from "./Header.astro";
import Servicios from "./Servicios.astro";
import RecommendationsCarousel from "./RecommendationsCarousel.astro";
import Hablemos from "./Hablemos.astro";
import Blog from "./Blog.astro";
import ParallaxText from "./ParallaxText.astro";
import Stack from "./Stack.astro";
import Asesorias from "./Asesorias.astro";
import ConsultaIA from "./ConsultaIA.astro";
import NewsletterReveal from "./NewsletterReveal.astro";
import Footer from "./Footer.astro";
import { getHomeRecommendations, enrichServices } from "../utils/recommendations";

const isVisible = true;

// Cargar servicios para recomendaciones
let recommendedServices: any[] = [];
try {
  const servicesResponse = await fetch(new URL('/services.json', Astro.url.origin));
  const allServices = await servicesResponse.json();

  // Obtener servicios recomendados para el home (los más populares y estratégicos)
  const recommendations = getHomeRecommendations(allServices);
  recommendedServices = enrichServices(recommendations);
} catch (error) {
  console.error('Error loading recommendations:', error);
}
---

<Header currentPage="home" />

<section
  id="home"
  class="relative flex items-center justify-center bg-hero-pattern bg-repeat w-full min-h-screen bg-[url(/img/fondo.png)] bg-no-repeat bg-cover bg-center"
>
  <div
    class="absolute inset-0 bg-gradient-to-b from-black/50 to-background z-10"
  >
  </div>

  <div class="container mx-auto px-4 py-20 md:py-24 relative z-20">
    <div
      class={`max-w-7xl mx-auto transition-all duration-1000 ${isVisible ? "translate-y-0 opacity-100" : "translate-y-10 opacity-0"}`}
    >
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
        <div class="text-center lg:text-left">
          <h1
            class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black mb-6 leading-tight"
          >
            <span class="text-white drop-shadow-lg"
              >HOY DÍA, LAS APLICACIONES USAN IA</span
            >
            <br />
            <span
              class="text-transparent bg-clip-text bg-gradient-to-r from-[#82e256] to-[#04ADC0] drop-shadow-lg"
            >
              Y PERMITEN EL USO DE AGENTES</span
            >
          </h1>
          <p
            class="text-base sm:text-lg md:text-xl lg:text-2xl text-gray-200 font-light max-w-2xl mt-4 md:mt-6 lg:mt-8 mx-auto lg:mx-0 text-center lg:text-left drop-shadow-md"
          >
            La evolución del software con inteligencia artificial ha llegado, te
            damos la bienvenida a
            <span class="text-bold text-[#04ADC0]">AQUI CREAMOS</span> donde desarrollamos
            ecosistemas digitales autónomos: Agentes, Apps Inteligentes
            y Arquitecturas Cloud de alto rendimiento, tal como el actual mercado
            lo demanda.
          </p>
        </div>

        <div
          id="full-images-header"
          class="relative w-full h-[400px] sm:h-[500px] lg:h-[600px] hidden lg:block"
        >
          <img
            src="/img/personaje2/01.png"
            class="carousel-img absolute inset-0 w-full h-full object-contain transition-opacity duration-1000 opacity-100"
            alt="Personaje IA"
          />
          <img
            src="/img/personaje2/02.png"
            class="carousel-img absolute inset-0 w-full h-full object-contain transition-opacity duration-1000 opacity-0"
            alt="Personaje IA"
          />
          <img
            src="/img/personaje2/03.png"
            class="carousel-img absolute inset-0 w-full h-full object-contain transition-opacity duration-1000 opacity-0"
            alt="Personaje IA"
          />
          <img
            src="/img/personaje2/04.png"
            class="carousel-img absolute inset-0 w-full h-full object-contain transition-opacity duration-1000 opacity-0"
            alt="Personaje IA"
          />
          <img
            src="/img/personaje2/05.png"
            class="carousel-img absolute inset-0 w-full h-full object-contain transition-opacity duration-1000 opacity-0"
            alt="Personaje IA"
          />
          <img
            src="/img/personaje2/06.png"
            class="carousel-img absolute inset-0 w-full h-full object-contain transition-opacity duration-1000 opacity-0"
            alt="Personaje IA"
          />
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", () => {
            // Seleccionar todos los contenedores de carrusel (header y secciones)
            const carousels = document.querySelectorAll(
              ".carousel-container, #full-images-header",
            );

            carousels.forEach((container) => {
              const images = container.querySelectorAll(".carousel-img");
              if (images.length > 0) {
                let currentIndex = 0;
                setInterval(() => {
                  images[currentIndex].classList.remove("opacity-100");
                  images[currentIndex].classList.add("opacity-0");

                  currentIndex = (currentIndex + 1) % images.length;

                  images[currentIndex].classList.remove("opacity-0");
                  images[currentIndex].classList.add("opacity-100");
                }, 3000);
              }
            });
          });
        </script>
      </div>
    </div>
  </div>
</section>

<main>
  <!-- Banderas flotantes (visible en todas las resoluciones) -->
  <div
    class="flex flex-col fixed top-20 z-50 right-4 justify-center items-center gap-2"
  >
    <img
      src="/img/banderaColombia.png"
      alt="Bandera Colombia"
      class="w-8 h-6 md:w-12 md:h-9 object-cover cursor-pointer hover:scale-110 transition-transform shadow-lg rounded-sm"
    />
    <!-- <img
      src="/img/banderaEstadosUnidos.png"
      alt="Bandera Estados Unidos"
      class="w-8 h-6 md:w-12 md:h-9 object-cover cursor-pointer hover:scale-110 transition-transform shadow-lg rounded-sm"
    />
    <img
      src="/img/banderaBrasil.png"
      alt="Bandera Brasil"
      class="w-8 h-6 md:w-12 md:h-9 object-cover cursor-pointer hover:scale-110 transition-transform shadow-lg rounded-sm"
    /> -->
  </div>
</main>

<main>
  <style>
    /* Paleta 1: Agentes (Verde/Dorado/Bosque) */
    @keyframes cycle-agents {
      0% {
        background-color: #01414a;
      }
      33% {
        background-color: #917e1f;
      }
      66% {
        background-color: #253a11;
      }
      100% {
        background-color: #01414a;
      }
    }

    /* Paleta 2: Apps IA (Púrpura/Azul Profundo) */
    @keyframes cycle-apps {
      0% {
        background-color: #1a0b2e;
      }
      33% {
        background-color: #2d1b4e;
      }
      66% {
        background-color: #0f172a;
      }
      100% {
        background-color: #1a0b2e;
      }
    }

    /* Paleta 3: Web (Azul Petróleo/Cian Oscuro) */
    @keyframes cycle-web {
      0% {
        background-color: #0f2027;
      }
      33% {
        background-color: #203a43;
      }
      66% {
        background-color: #2c5364;
      }
      100% {
        background-color: #0f2027;
      }
    }

    /* Paleta 4: Móvil (Teal/Esmeralda Oscuro) */
    @keyframes cycle-mobile {
      0% {
        background-color: #002b36;
      }
      33% {
        background-color: #004d40;
      }
      66% {
        background-color: #001e1d;
      }
      100% {
        background-color: #002b36;
      }
    }

    /* Paleta 5: Arquitectura (Gris Plomo/Metálico) */
    @keyframes cycle-arch {
      0% {
        background-color: #111827;
      }
      33% {
        background-color: #1f2937;
      }
      66% {
        background-color: #000000;
      }
      100% {
        background-color: #111827;
      }
    }

    /* Paleta 6: Visión (Índigo/Violeta Oscuro) */
    @keyframes cycle-vision {
      0% {
        background-color: #1e1b4b;
      }
      33% {
        background-color: #312e81;
      }
      66% {
        background-color: #020617;
      }
      100% {
        background-color: #1e1b4b;
      }
    }

    .animate-agents {
      animation: cycle-agents 15s infinite ease-in-out;
    }
    .animate-apps {
      animation: cycle-apps 18s infinite ease-in-out;
    }
    .animate-web {
      animation: cycle-web 20s infinite ease-in-out;
    }
    .animate-mobile {
      animation: cycle-mobile 16s infinite ease-in-out;
    }
    .animate-arch {
      animation: cycle-arch 22s infinite ease-in-out;
    }
    .animate-vision {
      animation: cycle-vision 19s infinite ease-in-out;
    }
  </style>

  <Servicios />
</main>


<!-- <Hablemos /> -->

<!-- <Blog /> -->

<ParallaxText />

<Stack />
<!-- Recomendaciones Estratégicas (Netflix-style Carousel) -->
<RecommendationsCarousel
  title="Algunas recomendaciones - Más Populares"
  subtitle="Algunas recomendaciones para ti tecnológicas que están transformando negocios"
  services={recommendedServices}
/>


<Asesorias />

<!-- Sección de Mentoring y Cursos de Arquitectura -->
<section
  id="mentoring"
  class="relative w-full md:px-16 px-5 py-20 bg-[#00464e] bg-[url(/img/fondo.png)] bg-no-repeat bg-cover bg-center"
>
  <!-- Overlay con color base -->
  <div class="absolute inset-0 bg-[#00464e]/50"></div>

  <!-- Tramado pattern -->
  <div
    class="absolute inset-0"
    style="background-image: url('data:image/svg+xml,%3Csvg width=%2760%27 height=%2760%27 viewBox=%270 0 60 60%27 xmlns=%27http://www.w3.org/2000/svg%27%3E%3Cg fill=%27none%27 fill-rule=%27evenodd%27%3E%3Cg fill=%27%23ffffff%27 fill-opacity=%270.03%27%3E%3Cpath d=%27M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z%27/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); opacity: 0.5;"
  >
  </div>

  <div class="max-w-7xl mx-auto relative z-10">
    <!-- Main Header -->
    <div class="text-center mb-12">
      <h1
        class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black mb-6 leading-tight bg-gradient-to-r from-white via-white to-[#82e256] bg-clip-text text-transparent"
      >
        Mentoring y Cursos Especializados
      </h1>
      <p class="text-white/70 text-lg max-w-3xl mx-auto">
        Eleva las habilidades de tu equipo con nuestros programas de mentoring y
        cursos especializados en arquitectura de software
      </p>

      <!-- Sección de Publicidad: Mentoring y Cursos Especializados -->
      <section class="w-full py-16 border-y border-white/5">
        <div class="max-w-6xl mx-auto px-5 md:px-16">
          <div
            class="bg-gradient-to-br from-[#82e256]/10 via-[#6bc73d]/5 to-transparent rounded-3xl p-8 md:p-12 border border-[#82e256]/20 relative overflow-hidden"
          >
            <!-- Decoración de fondo -->
            <div
              class="absolute top-0 right-0 w-64 h-64 bg-[#82e256]/5 rounded-full blur-3xl"
            >
            </div>
            <div
              class="absolute bottom-0 left-0 w-48 h-48 bg-[#6bc73d]/5 rounded-full blur-3xl"
            >
            </div>

            <div class="relative z-10">
              <h2 class="text-4xl font-black mb-6 leading-tight text-white">
                ¿Tu equipo necesita capacitación?
              </h2>
              <p
                class="text-white/70 text-lg mb-8 max-w-2xl text-center mx-auto"
              >
                Llevamos la experiencia directamente a tu equipo con programas
                de mentoring personalizado y cursos especializados en las
                tecnologías más demandadas.
              </p>

              <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- Mentoring Personalizado -->
                <div
                  class="bg-black/30 backdrop-blur-sm rounded-xl p-6 border border-white/10"
                >
                  <div class="flex items-start gap-4 mb-4">
                    <div
                      class="w-12 h-12 bg-gradient-to-br from-[#82e256] to-[#6bc73d] rounded-lg flex items-center justify-center flex-shrink-0"
                    >
                      <svg
                        class="w-6 h-6 text-black"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                        ></path>
                      </svg>
                    </div>
                    <div>
                      <h3 class="text-xl font-bold text-white mb-2">
                        Mentoring Personalizado
                      </h3>
                      <p class="text-white/60 text-sm mb-3">
                        Acompañamiento 1:1 o para equipos con expertos en
                        arquitectura, IA y DevOps
                      </p>
                      <ul class="space-y-2 text-sm text-white/70">
                        <li class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 bg-[#82e256] rounded-full"
                          ></span>
                          Sesiones personalizadas según tus necesidades
                        </li>
                        <li class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 bg-[#82e256] rounded-full"
                          ></span>
                          Revisión de código en tiempo real
                        </li>
                        <li class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 bg-[#82e256] rounded-full"
                          ></span>
                          Roadmaps de crecimiento profesional
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Cursos Especializados -->
                <div
                  class="bg-black/30 backdrop-blur-sm rounded-xl p-6 border border-white/10"
                >
                  <div class="flex items-start gap-4 mb-4">
                    <div
                      class="w-12 h-12 bg-gradient-to-br from-[#82e256] to-[#6bc73d] rounded-lg flex items-center justify-center flex-shrink-0"
                    >
                      <svg
                        class="w-6 h-6 text-black"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                        ></path>
                      </svg>
                    </div>
                    <div>
                      <h3 class="text-xl font-bold text-white mb-2">
                        Cursos Especializados
                      </h3>
                      <p class="text-white/60 text-sm mb-3">
                        Programas intensivos in-company o remotos con
                        certificación
                      </p>
                      <ul class="space-y-2 text-sm text-white/70">
                        <li class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 bg-[#82e256] rounded-full"
                          ></span>
                          Arquitectura de Software Avanzada
                        </li>
                        <li class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 bg-[#82e256] rounded-full"
                          ></span>
                          IA Generativa & LLMs en Producción
                        </li>
                        <li class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 bg-[#82e256] rounded-full"
                          ></span>
                          DevOps & Cloud Native
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- CTA -->
              <div
                class="flex flex-col sm:flex-row gap-4 items-center justify-center"
              >
                <a
                  href="#asesorias"
                  class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-[#82e256] to-[#6bc73d] hover:from-[#6bc73d] hover:to-[#5ba62e] text-black font-bold rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
                >
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    ></path>
                  </svg>
                  <span>Agenda tu Sesión</span>
                </a>
                <button
                  id="open-floating-chat-mentoring"
                  class="inline-flex items-center gap-3 px-8 py-4 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-[#82e256]/50 text-white font-semibold rounded-xl transition-all duration-300"
                >
                  <img
                    src="/img/ia.svg"
                    style="filter: invert(1)"
                    alt="Chat"
                    class="w-5 h-5"
                  />
                  <span>Consultar Detalles</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</section>

<ConsultaIA />

<script is:inline>
  // Smooth scroll con offset para header fijo
  document.addEventListener("DOMContentLoaded", () => {
    const headerHeight = 64; // Altura aproximada del header

    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
      anchor.addEventListener("click", function (e) {
        const href = this.getAttribute("href");

        // Ignorar enlaces vacíos o solo "#"
        if (!href || href === "#") return;

        e.preventDefault();
        const targetId = href.substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          const targetPosition = targetElement.offsetTop - headerHeight;

          window.scrollTo({
            top: targetPosition,
            behavior: "smooth",
          });

          // Actualizar URL sin saltar
          history.pushState(null, "", href);
        }
      });
    });

    // FAQ Accordion functionality
    const faqQuestions = document.querySelectorAll(".faq-question");

    faqQuestions.forEach((question) => {
      question.addEventListener("click", () => {
        const faqItem = question.parentElement;
        const answer = faqItem.querySelector(".faq-answer");
        const icon = question.querySelector("svg");
        const isOpen =
          answer.style.maxHeight && answer.style.maxHeight !== "0px";

        // Cerrar todos los otros FAQ items
        document.querySelectorAll(".faq-answer").forEach((otherAnswer) => {
          if (otherAnswer !== answer) {
            otherAnswer.style.maxHeight = "0px";
            otherAnswer.parentElement.querySelector("svg").style.transform =
              "rotate(0deg)";
          }
        });

        // Toggle el actual
        if (isOpen) {
          answer.style.maxHeight = "0px";
          icon.style.transform = "rotate(0deg)";
        } else {
          answer.style.maxHeight = answer.scrollHeight + "px";
          icon.style.transform = "rotate(180deg)";
        }
      });
    });

    // AI Answer Accordion functionality
    function setupAIAnswerAccordions() {
      const aiAnswerHeaders = document.querySelectorAll(".ai-answer-header");

      aiAnswerHeaders.forEach((header) => {
        header.addEventListener("click", () => {
          const answerItem = header.parentElement;
          const content = answerItem.querySelector(".ai-answer-content");
          const icon = header.querySelector("svg:last-child");
          const isOpen =
            content.style.maxHeight && content.style.maxHeight !== "0px";

          // Toggle el actual
          if (isOpen) {
            content.style.maxHeight = "0px";
            icon.style.transform = "rotate(0deg)";
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
            icon.style.transform = "rotate(180deg)";
          }
        });
      });
    }

    // AI Question Form functionality
    const aiForm = document.getElementById("ai-question-form");
    const aiInput = document.getElementById("ai-question-input");
    const submitText = document.getElementById("submit-text");
    const loadingSpinner = document.getElementById("loading-spinner");
    const responseContainer = document.getElementById("ai-response-container");
    const mainResponseDiv = document.getElementById("ai-main-response");
    const sourcesDiv = document.getElementById("ai-sources");
    const contextDiv = document.getElementById("ai-context");
    const contextSection = document.getElementById("context-section");
    const sourcesCount = document.getElementById("sources-count");

    if (aiForm) {
      aiForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const question = aiInput.value.trim();
        if (!question) return;

        // Mostrar loading
        submitText.classList.add("hidden");
        loadingSpinner.classList.remove("hidden");

        try {
          // AQUÍ INTEGRARÁS TU LLAMADA A OPENAI API CON RAG
          // Ejemplo de cómo quedaría:
          /*
          const response = await fetch('/api/ask-ai', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ question })
          });

          const data = await response.json();
          // data debería contener:
          // {
          //   answer: "La respuesta de ChatGPT...",
          //   sources: [
          //     { title: "Fuente 1", url: "https://...", snippet: "..." },
          //     { title: "Fuente 2", url: "https://...", snippet: "..." }
          //   ],
          //   context: "Contexto adicional opcional..."
          // }
          */

          // Simulación de respuesta para el diseño (REEMPLAZAR CON OPENAI + RAG)
          await new Promise((resolve) => setTimeout(resolve, 2000));

          const mockAnswer = `Para implementar autenticación en una API REST, las mejores prácticas incluyen:

**1. JSON Web Tokens (JWT)**
- Emisión de tokens tras login exitoso
- Validación en cada petición
- Tokens con expiración corta

**2. OAuth 2.0**
- Ideal para integraciones con terceros
- Soporte para diferentes flujos (Authorization Code, Client Credentials)
- Mayor seguridad con refresh tokens

**3. Consideraciones de Seguridad**
- HTTPS obligatorio en producción
- Almacenamiento seguro de secrets
- Rate limiting para prevenir ataques de fuerza bruta
- Implementación de CORS apropiada

La elección depende de tu caso de uso específico. Para APIs internas, JWT suele ser suficiente. Para plataformas que requieren acceso de terceros, OAuth 2.0 es más apropiado.`;

          const mockSources = [
            {
              title:
                "Arquitectura Hexagonal: Por qué es la Mejor Opción para Microservicios",
              url: "/blog/arquitectura-hexagonal-microservicios",
              snippet:
                "La arquitectura hexagonal separa claramente el dominio de la infraestructura, permitiendo implementar autenticación de forma desacoplada...",
            },
            {
              title: "JWT Best Practices - Auth0 Documentation",
              url: "https://auth0.com/docs/secure/tokens/json-web-tokens",
              snippet:
                "JSON Web Tokens should be short-lived and stored securely. Use HttpOnly cookies or secure storage mechanisms...",
            },
            {
              title: "OAuth 2.0 Specification - RFC 6749",
              url: "https://datatracker.ietf.org/doc/html/rfc6749",
              snippet:
                "The OAuth 2.0 authorization framework enables a third-party application to obtain limited access to an HTTP service...",
            },
          ];

          const mockContext = `Esta respuesta se generó basándose en las mejores prácticas de seguridad actuales y documentación oficial. Se analizaron 3 fuentes relevantes incluyendo artículos de tu blog y documentación técnica estándar.`;

          // Insertar respuesta principal
          mainResponseDiv.innerHTML = mockAnswer;

          // Insertar fuentes RAG si existen
          if (mockSources && mockSources.length > 0) {
            sourcesCount.textContent = mockSources.length;
            sourcesCount.classList.remove("hidden");

            const sourcesHTML = mockSources
              .map(
                (source, index) => `
              <div class="bg-black/30 border border-white/5 rounded-lg p-4 hover:border-[#04ADC0]/30 transition-all duration-300">
                <div class="flex items-start gap-3">
                  <div class="flex-shrink-0 w-8 h-8 bg-[#04ADC0]/20 rounded-lg flex items-center justify-center">
                    <span class="text-[#04ADC0] font-bold text-sm">${index + 1}</span>
                  </div>
                  <div class="flex-1">
                    <h4 class="text-white font-semibold text-sm mb-1">${source.title}</h4>
                    <p class="text-white/60 text-xs mb-2 leading-relaxed">${source.snippet}</p>
                    <a href="${source.url}" target="_blank" class="inline-flex items-center gap-1 text-[#04ADC0] text-xs hover:text-[#82e256] transition-colors">
                      <span>Ver fuente</span>
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            `,
              )
              .join("");

            sourcesDiv.innerHTML = `<div class="space-y-3">${sourcesHTML}</div>`;
          } else {
            sourcesCount.classList.add("hidden");
            sourcesDiv.innerHTML =
              '<p class="text-white/0 text-sm italic">No hay fuentes disponibles para esta respuesta.</p>';
          }

          // Insertar contexto si existe
          if (mockContext) {
            contextDiv.innerHTML = mockContext;
            contextSection.classList.remove("hidden");
          } else {
            contextSection.classList.add("hidden");
          }

          // Mostrar contenedor con animación
          responseContainer.classList.remove("hidden");

          // Animar la aparición
          setTimeout(() => {
            responseContainer.style.opacity = "0";
            responseContainer.style.transform = "translateY(10px)";
            responseContainer.style.transition = "all 0.3s ease";
            setTimeout(() => {
              responseContainer.style.opacity = "1";
              responseContainer.style.transform = "translateY(0)";
            }, 10);
          }, 10);

          // Abrir automáticamente la primera sección (Respuesta Principal)
          setTimeout(() => {
            const firstHeader = document.querySelector(".ai-answer-header");
            if (firstHeader) {
              firstHeader.click();
            }
          }, 400);

          // Setup accordion functionality
          setupAIAnswerAccordions();
        } catch (error) {
          console.error("Error:", error);
          mainResponseDiv.innerHTML =
            '<p class="text-red-400">Hubo un error al procesar tu pregunta. Por favor, intenta de nuevo.</p>';
          responseContainer.classList.remove("hidden");

          // Abrir la respuesta de error
          setTimeout(() => {
            const firstHeader = document.querySelector(".ai-answer-header");
            if (firstHeader) {
              firstHeader.click();
            }
          }, 100);

          setupAIAnswerAccordions();
        } finally {
          // Restaurar botón
          submitText.classList.remove("hidden");
          loadingSpinner.classList.add("hidden");
        }
      });
    }

    // Advisory Form Validation and Submission
    const advisoryForm = document.getElementById("advisory-form");
    const advisorySubmitBtn = document.getElementById("advisory-submit-btn");
    const advisoryName = document.getElementById("advisory-name");
    const advisoryEmail = document.getElementById("advisory-email");
    const advisoryPhone = document.getElementById("advisory-phone");
    const advisoryDescription = document.getElementById("advisory-description");

    function validateAdvisoryForm() {
      const name = advisoryName.value.trim();
      const email = advisoryEmail.value.trim();
      const phone = advisoryPhone.value.trim();
      const description = advisoryDescription.value.trim();
      const advisoryType = document.querySelector(
        'input[name="advisory-type"]:checked',
      );

      const isValid = name && email && phone && description && advisoryType;

      if (isValid) {
        // Habilitar botón
        advisorySubmitBtn.disabled = false;
        advisorySubmitBtn.classList.remove(
          "bg-gradient-to-r",
          "from-white/20",
          "to-white/10",
          "text-white/0",
          "cursor-not-allowed",
        );
        advisorySubmitBtn.classList.add(
          "bg-gradient-to-r",
          "from-[#82e256]",
          "to-[#6bc73d]",
          "hover:from-[#6bc73d]",
          "hover:to-[#5ba62e]",
          "text-black",
          "cursor-pointer",
          "hover:scale-[1.02]",
          "hover:shadow-2xl",
          "shadow-lg",
        );
        advisorySubmitBtn.querySelector("svg").innerHTML = `
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        `;
        advisorySubmitBtn.querySelector("span").textContent =
          "Continuar a Evaluación";
      } else {
        // Deshabilitar botón
        advisorySubmitBtn.disabled = true;
        advisorySubmitBtn.classList.add(
          "bg-gradient-to-r",
          "from-white/20",
          "to-white/10",
          "text-white/0",
          "cursor-not-allowed",
        );
        advisorySubmitBtn.classList.remove(
          "from-[#82e256]",
          "to-[#6bc73d]",
          "hover:from-[#6bc73d]",
          "hover:to-[#5ba62e]",
          "text-black",
          "cursor-pointer",
          "hover:scale-[1.02]",
          "hover:shadow-2xl",
          "shadow-lg",
        );
        advisorySubmitBtn.querySelector("svg").innerHTML = `
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
        `;
        advisorySubmitBtn.querySelector("span").textContent =
          "Completa todos los campos";
      }
    }

    // Validar en cada cambio
    if (advisoryForm) {
      advisoryName.addEventListener("input", validateAdvisoryForm);
      advisoryEmail.addEventListener("input", validateAdvisoryForm);
      advisoryPhone.addEventListener("input", validateAdvisoryForm);
      advisoryDescription.addEventListener("input", validateAdvisoryForm);

      document
        .querySelectorAll('input[name="advisory-type"]')
        .forEach((radio) => {
          radio.addEventListener("change", validateAdvisoryForm);
        });

      // COMENTADO: El manejo del submit ahora se hace en Asesorias.astro con el nuevo sistema de agendamiento
      /*
      advisoryForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = {
          name: advisoryName.value.trim(),
          email: advisoryEmail.value.trim(),
          phone: advisoryPhone.value.trim(),
          advisoryType: document.querySelector('input[name="advisory-type"]:checked').value,
          description: advisoryDescription.value.trim(),
          timestamp: new Date().toISOString(),
        };
        localStorage.setItem("advisoryFormData", JSON.stringify(formData));
        window.location.href = "/primera-sesion";
      });
      */
    }
  });
</script>

<NewsletterReveal />
<Footer />

<!-- Botón flotante para abrir videos shorts -->
<button
  id="videos-toggle-btn"
  class="fixed bottom-8 left-6 bg-gradient-to-br from-black-600 to-red-600 p-4 rounded-full hover:scale-110 transition-all duration-300 z-50"
  aria-label="Ver videos"
>
  <img src="/img/play.svg" alt="playvideo" class="h-8 w-8 invert" />
</button>

<!-- Modal de videos shorts (oculto por defecto) -->
<div
  id="videos-container"
  class="hidden fixed inset-0 flex items-center justify-center"
  style="z-index: 999999;"
>
  <!-- Backdrop -->
  <div
    class="absolute inset-0 bg-black/90 backdrop-blur-sm"
    id="videos-backdrop"
  >
  </div>

  <!-- Modal Content -->
  <div class="relative z-10 w-full h-full flex items-center justify-center p-4">
    <div
      class="bg-gradient-to-br from-gray-900/95 to-black/95 backdrop-blur-xl rounded-2xl p-4 shadow-2xl border border-gray-800"
    >
      <!-- Header -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <span class="material-symbols-outlined text-red-500">videocam</span>
          <h3 class="text-white font-bold text-sm">Shorts</h3>
        </div>
        <button
          id="close-videos-btn"
          class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full"
          aria-label="Cerrar videos"
        >
          <span class="material-symbols-outlined text-2xl">close</span>
        </button>
      </div>

      <!-- Videos grid -->
      <div class="flex gap-3">
        <!-- Video 1 -->
        <div class="video-item group relative" data-video-id="1">
          <div
            class="relative rounded-xl overflow-hidden border-2 border-gray-700 hover:border-[#82e256] transition-all duration-300 cursor-pointer"
          >
            <!-- Expand button -->
            <button
              class="expand-btn absolute top-2 right-2 z-10 bg-black/60 hover:bg-black/80 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-all duration-200"
              data-video="1"
            >
              <span class="material-symbols-outlined text-xs expand-icon"
                >open_in_full</span
              >
            </button>

            <!-- Unmute indicator -->
            <button
              class="unmute-btn absolute bottom-2 right-2 z-10 bg-black/60 hover:bg-[#82e256] text-white rounded-full p-1.5 transition-all duration-200"
              data-video="1"
              title="Toca para activar sonido"
            >
              <span class="material-symbols-outlined text-sm volume-icon"
                >volume_off</span
              >
            </button>

            <iframe
              class="video-frame transition-all duration-500"
              width="120"
              height="213"
              src="https://www.youtube.com/embed/4d_K-DYSi5M?autoplay=0&mute=1&loop=1&playlist=4d_K-DYSi5M&controls=1&modestbranding=1&rel=0&enablejsapi=1"
              title="YouTube Short 1"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
          </div>
        </div>

        <!-- Video 2 -->
        <div class="video-item group relative" data-video-id="2">
          <div
            class="relative rounded-xl overflow-hidden border-2 border-gray-700 hover:border-[#82e256] transition-all duration-300 cursor-pointer"
          >
            <!-- Expand button -->
            <button
              class="expand-btn absolute top-2 right-2 z-10 bg-black/60 hover:bg-black/80 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-all duration-200"
              data-video="2"
            >
              <span class="material-symbols-outlined text-xs expand-icon"
                >open_in_full</span
              >
            </button>

            <!-- Unmute indicator -->
            <button
              class="unmute-btn absolute bottom-2 right-2 z-10 bg-black/60 hover:bg-[#82e256] text-white rounded-full p-1.5 transition-all duration-200"
              data-video="2"
              title="Toca para activar sonido"
            >
              <span class="material-symbols-outlined text-sm volume-icon"
                >volume_off</span
              >
            </button>

            <iframe
              class="video-frame transition-all duration-500"
              width="120"
              height="213"
              src="https://www.youtube.com/embed/4d_K-DYSi5M?autoplay=0&mute=1&loop=1&playlist=4d_K-DYSi5M&controls=1&modestbranding=1&rel=0&enablejsapi=1"
              title="YouTube Short 2"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
          </div>
        </div>
      </div>

      <!-- Tip -->
      <div class="mt-3 flex items-center gap-2 text-xs text-gray-400">
        <span class="material-symbols-outlined text-sm">info</span>
        <span>Toca el video para activar sonido</span>
      </div>
    </div>
  </div>
</div>

<script>
  // ═══════════════════════════════════════════════════════════════════
  // ██╗  ██╗ ██████╗ ███╗   ███╗███████╗
  // ██║  ██║██╔═══██╗████╗ ████║██╔════╝
  // ███████║██║   ██║██╔████╔██║█████╗
  // ██╔══██║██║   ██║██║╚██╔╝██║██╔══╝
  // ██║  ██║╚██████╔╝██║ ╚═╝ ██║███████╗
  // ╚═╝  ╚═╝ ╚═════╝ ╚═╝     ╚═╝╚══════╝
  // ═══════════════════════════════════════════════════════════════════
  // VIDEO FLOTANTE DE HOME (botón lateral izquierdo)
  // Este es el componente de video shorts que aparece flotando en el lateral izquierdo
  // ═══════════════════════════════════════════════════════════════════

  // Videos Shorts Manager
  document.addEventListener("DOMContentLoaded", () => {
    const videosToggleBtn = document.getElementById("videos-toggle-btn");
    const videosContainer = document.getElementById("videos-container");
    const closeVideosBtn = document.getElementById("close-videos-btn");
    const expandBtns = document.querySelectorAll(".expand-btn");
    const unmuteBtns = document.querySelectorAll(".unmute-btn");

    // Estado de videos
    const videoStates = new Map();
    videoStates.set("1", { expanded: false, muted: true });
    videoStates.set("2", { expanded: false, muted: true });

    // Tamaños
    const sizes = {
      small: { width: 120, height: 213 },
      large: { width: 240, height: 426 },
    };

    // Función para cerrar el modal de videos
    const closeVideosModal = () => {
      videosContainer?.classList.add("hidden");
      document.body.style.overflow = "auto";

      if (videosToggleBtn) {
        videosToggleBtn.style.transform = "scale(1)";
        videosToggleBtn.style.opacity = "1";
      }

      // Detener todos los videos reseteando los iframes
      const iframes = videosContainer?.querySelectorAll(".video-frame");
      iframes?.forEach((iframe) => {
        const src = iframe.src;
        iframe.src = "";
        setTimeout(() => {
          iframe.src = src;
        }, 100);
      });
    };

    // Función para abrir el modal de videos
    const openVideosModal = () => {
      videosContainer?.classList.remove("hidden");
      document.body.style.overflow = "hidden";
      videosToggleBtn.style.transform = "scale(0.9)";
      videosToggleBtn.style.opacity = "0.7";
    };

    // Abrir/Cerrar panel de videos con el botón toggle
    videosToggleBtn?.addEventListener("click", () => {
      if (videosContainer?.classList.contains("hidden")) {
        openVideosModal();
      } else {
        closeVideosModal();
      }
    });

    // Cerrar con el botón X
    closeVideosBtn?.addEventListener("click", () => {
      closeVideosModal();
    });

    // Cerrar con click en el backdrop
    const videosBackdrop = document.getElementById("videos-backdrop");
    videosBackdrop?.addEventListener("click", () => {
      closeVideosModal();
    });

    // Cerrar con tecla ESC
    document.addEventListener("keydown", (e) => {
      if (
        e.key === "Escape" &&
        videosContainer &&
        !videosContainer.classList.contains("hidden")
      ) {
        closeVideosModal();
      }
    });

    // Expandir/Contraer videos
    expandBtns.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const videoId = btn.getAttribute("data-video");
        if (!videoId) return;

        const state = videoStates.get(videoId);
        const videoItem = document.querySelector(
          `[data-video-id="${videoId}"]`,
        );
        const iframe = videoItem?.querySelector(
          ".video-frame",
        ) as HTMLIFrameElement;
        const icon = btn.querySelector(".expand-icon");

        if (state && iframe && icon) {
          state.expanded = !state.expanded;

          if (state.expanded) {
            iframe.width = sizes.large.width.toString();
            iframe.height = sizes.large.height.toString();
            icon.textContent = "close_fullscreen";
          } else {
            iframe.width = sizes.small.width.toString();
            iframe.height = sizes.small.height.toString();
            icon.textContent = "open_in_full";
          }
        }
      });
    });

    // Activar/Desactivar sonido al tocar el video o el botón
    unmuteBtns.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        const videoId = btn.getAttribute("data-video");
        if (!videoId) return;

        const state = videoStates.get(videoId);
        const videoItem = document.querySelector(
          `[data-video-id="${videoId}"]`,
        );
        const iframe = videoItem?.querySelector(
          ".video-frame",
        ) as HTMLIFrameElement;
        const volumeIcon = btn.querySelector(".volume-icon");

        if (state && iframe && volumeIcon) {
          state.muted = !state.muted;

          // Cambiar el parámetro mute en la URL del iframe
          const currentSrc = iframe.src;
          if (state.muted) {
            iframe.src = currentSrc.replace("mute=0", "mute=1");
            volumeIcon.textContent = "volume_off";
            btn.classList.remove("bg-[#82e256]");
            btn.classList.add("bg-black/60");
          } else {
            iframe.src = currentSrc.replace("mute=1", "mute=0");
            volumeIcon.textContent = "volume_up";
            btn.classList.remove("bg-black/60");
            btn.classList.add("bg-[#82e256]");
          }
        }
      });
    });

    // También permitir activar sonido al hacer clic en el iframe
    document.querySelectorAll(".video-frame").forEach((iframe, index) => {
      iframe.addEventListener("click", () => {
        const videoId = (index + 1).toString();
        const unmuteBtn = document.querySelector(
          `.unmute-btn[data-video="${videoId}"]`,
        ) as HTMLButtonElement;
        if (unmuteBtn) {
          unmuteBtn.click();
        }
      });
    });
  });

  // Service Videos Manager
  document.querySelectorAll(".service-video-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const serviceId = btn.getAttribute("data-service");
      const container = document.getElementById(`videos-${serviceId}`);

      if (container) {
        // Cerrar todos los otros contenedores de videos
        document.querySelectorAll(".service-videos-container").forEach((c) => {
          if (c.id !== `videos-${serviceId}`) {
            c.classList.add("hidden");
          }
        });

        // Toggle el contenedor actual
        container.classList.toggle("hidden");
      }
    });
  });

  // Cerrar videos de servicio
  document.querySelectorAll(".close-service-video").forEach((btn) => {
    btn.addEventListener("click", () => {
      const serviceId = btn.getAttribute("data-service");
      const container = document.getElementById(`videos-${serviceId}`);

      if (container) {
        container.classList.add("hidden");
      }
    });
  });
</script>

---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
---

<Layout>
  <Header currentPage="aquicreamos" />

  <!-- Hero Section -->
  <section class="pt-32 pb-16 bg-gradient-to-br from-[#00464e] to-[#006064]">
    <div class="container mx-auto px-4 md:px-16">
      <div class="max-w-5xl mx-auto text-center">
        <!-- √çcono decorativo -->
        <div class="inline-flex items-center justify-center w-20 h-20 md:w-24 md:h-24 bg-gradient-to-br from-[#82e256] to-[#6bc73d] rounded-2xl mb-8 shadow-xl animate-pulse">
          <svg class="w-11 h-11 md:w-13 md:h-13 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
          </svg>
        </div>

        <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-black mb-6 leading-tight">
          <span class="text-white">Aqu√≠ </span>
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#82e256] via-[#6bc73d] to-[#04ADC0]">Creamos</span>
        </h1>

        <p class="text-lg md:text-xl lg:text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed mb-8">
          Servicios profesionales de desarrollo y tecnolog√≠a para impulsar tu negocio
        </p>

        <!-- L√≠nea decorativa -->
        <div class="flex items-center justify-center gap-2">
          <div class="h-px w-16 md:w-24 bg-gradient-to-r from-transparent to-[#82e256]"></div>
          <div class="w-2 h-2 rounded-full bg-[#82e256]"></div>
          <div class="h-px w-16 md:w-24 bg-gradient-to-l from-transparent to-[#82e256]"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tabs: Servicios / Automatizaciones -->
  <section class="py-6 bg-[#1a1a1a] border-b border-gray-800">
    <div class="container mx-auto px-4 md:px-16">
      <div class="max-w-7xl mx-auto">
        <div class="flex gap-4 justify-center">
          <button
            id="tab-servicios"
            class="tab-button active px-8 py-3 rounded-lg font-bold text-lg transition-all"
          >
            üì¶ Servicios Profesionales
          </button>
          <button
            id="tab-automatizaciones"
            class="tab-button px-8 py-3 rounded-lg font-bold text-lg transition-all"
          >
            ‚ö° Automatizaciones IA
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Filtros y b√∫squeda unificados -->
  <section id="section-filtros" class="py-8 bg-[#1a1a1a] border-b border-gray-800">
    <div class="container mx-auto px-4 md:px-16">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col gap-4">
          <!-- Campo de b√∫squeda unificado -->
          <div class="w-full">
            <div class="relative">
              <!-- Input principal con √≠conos -->
              <div class="relative bg-gray-800 border border-gray-700 rounded-lg focus-within:ring-2 focus-within:ring-[#82e256] transition-all">
                <div class="flex items-center">
                  <!-- √çcono de b√∫squeda -->
                  <svg class="absolute left-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                  </svg>

                  <!-- Input de b√∫squeda -->
                  <input
                    type="text"
                    id="search-input"
                    placeholder="Buscar servicios por nombre, descripci√≥n o categor√≠a..."
                    class="flex-1 px-4 py-3 pl-12 pr-32 bg-transparent text-white outline-none"
                  />

                  <!-- Botones de acci√≥n -->
                  <div class="absolute right-3 flex items-center gap-2">
                    <!-- Bot√≥n de limpiar b√∫squeda -->
                    <button
                      id="clear-search-btn"
                      class="hidden text-gray-400 hover:text-[#82e256] transition-colors p-1"
                      title="Limpiar b√∫squeda"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                      </svg>
                    </button>

                    <!-- Separador -->
                    <div class="w-px h-6 bg-gray-600"></div>

                    <!-- Bot√≥n de filtros -->
                    <button
                      id="filter-toggle-btn"
                      class="flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-all"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                      </svg>
                      <span class="text-sm font-semibold">Filtros</span>
                      <span id="filter-badge" class="hidden bg-[#82e256] text-black text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </button>
                  </div>
                </div>

                <!-- Chips de categor√≠as seleccionadas dentro del input -->
                <div id="selected-categories-chips" class="hidden flex flex-wrap gap-2 px-4 pb-3 pt-1">
                  <!-- Los chips se generar√°n din√°micamente -->
                </div>
              </div>

              <!-- Mini card flotante de filtros -->
              <div id="filter-dropdown" class="hidden absolute z-20 right-0 mt-2 w-full md:w-96 bg-gray-800 border border-gray-700 rounded-xl shadow-2xl overflow-hidden">
                <!-- Header -->
                <div class="flex items-center justify-between p-4 border-b border-gray-700 bg-gray-750">
                  <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-[#82e256]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    <h3 class="text-white font-bold text-sm">Filtrar por categor√≠a</h3>
                  </div>
                  <button id="clear-categories" class="text-[#82e256] hover:text-[#6bc73d] text-xs font-semibold transition-colors">
                    Limpiar
                  </button>
                </div>

                <!-- Lista de checkboxes -->
                <div id="category-checkboxes" class="p-3 max-h-80 overflow-y-auto space-y-1">
                  <!-- Checkboxes se generar√°n din√°micamente -->
                </div>

                <!-- Footer con bot√≥n aplicar -->
                <div class="p-3 border-t border-gray-700 bg-gray-750">
                  <button
                    id="apply-filters-btn"
                    class="w-full py-2 bg-gradient-to-r from-[#82e256] to-[#6bc73d] text-black font-bold rounded-lg hover:shadow-lg transition-all"
                  >
                    Aplicar filtros
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Contador de resultados y bot√≥n limpiar todo -->
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="text-gray-400 text-sm">
              <span id="results-count">0</span> <span id="results-type">resultados</span> disponibles
            </div>

            <button
              id="clear-all-filters"
              class="hidden text-sm text-[#82e256] hover:text-[#6bc73d] font-semibold transition-colors flex items-center gap-1"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
              Limpiar todos los filtros
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Grid de servicios -->
  <section id="content-servicios" class="tab-content py-16 bg-[#1a1a1a] min-h-screen">
    <div class="container mx-auto px-4 md:px-16">
      <div class="max-w-7xl mx-auto">
        <div
          id="services-container"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Los servicios se cargar√°n din√°micamente -->
        </div>

        <!-- Mensaje cuando no hay resultados -->
        <div id="no-results" class="hidden text-center py-16">
          <div class="text-gray-400 text-xl mb-4">No se encontraron servicios</div>
          <button
            id="clear-search"
            class="text-[#82e256] hover:text-[#6bc73d] transition-colors"
          >
            Limpiar b√∫squeda
          </button>
        </div>

        <!-- Loading state -->
        <div id="loading" class="text-center py-16">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[#82e256]"></div>
          <p class="text-gray-400 mt-4">Cargando servicios...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Grid de automatizaciones -->
  <section id="content-automatizaciones" class="tab-content hidden py-16 bg-[#1a1a1a] min-h-screen">
    <div class="container mx-auto px-4 md:px-16">
      <div class="max-w-7xl mx-auto">
        <div
          id="workflows-container"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
        >
          <!-- Los workflows se cargar√°n din√°micamente -->
        </div>
      </div>
    </div>
  </section>

  <!-- Modal de IA para chat de servicios -->
  <div id="ai-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="ai-modal-content bg-[#1a1a1a] rounded-3xl max-w-3xl w-full h-[85vh] flex flex-col border border-gray-800">
      <!-- Header -->
      <div class="bg-[#1a1a1a] border-b border-gray-800 p-6 flex items-center justify-between flex-shrink-0">
        <div class="flex items-center gap-3">
          <span class="text-5xl" id="ai-modal-emoji">ü§ñ</span>
          <div>
            <h3 class="text-xl font-bold text-white" id="ai-modal-title">Asistente de IA</h3>
            <p class="text-sm text-gray-400" id="ai-modal-subtitle">Preg√∫ntame sobre este servicio</p>
          </div>
        </div>
        <button id="close-ai-modal" class="text-gray-400 hover:text-white transition-colors">
          <span class="material-symbols-outlined text-3xl">close</span>
        </button>
      </div>

      <!-- Chat Messages Area -->
      <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4">
        <!-- Messages will be added here dynamically -->
      </div>

      <!-- Input Area -->
      <div class="border-t border-gray-800 p-4 bg-[#1a1a1a] flex-shrink-0">
        <form id="chat-form" class="flex gap-3">
          <input
            type="text"
            id="chat-input"
            placeholder="Escribe tu pregunta..."
            class="flex-1 px-4 py-3 bg-gray-900 border border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#82e256] text-white"
            autocomplete="off"
          />
          <button
            type="submit"
            id="send-btn"
            class="px-6 py-3 bg-gradient-to-r from-[#82e256] to-[#6bc73d] text-black rounded-xl font-semibold hover:shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 flex items-center gap-2"
          >
            <span class="material-symbols-outlined">send</span>
            <span class="hidden sm:inline">Enviar</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</Layout>

<script>
  let allServices: any[] = [];
  let selectedCategories: Set<string> = new Set();
  let availableCategories: string[] = [];
  let searchQuery: string = '';

  // Cargar servicios desde el JSON
  async function loadServices() {
    try {
      const response = await fetch('/services.json');
      allServices = await response.json();

      // Extraer categor√≠as √∫nicas
      availableCategories = [...new Set(allServices.map(s => s.category).filter(Boolean))];

      // Inicializar categor√≠as desde URL
      initializeCategoriesFromURL();

      // Renderizar checkboxes de categor√≠as
      renderCategoryCheckboxes();

      // Actualizar display de categor√≠as seleccionadas
      updateSelectedCategoriesDisplay();

      // Actualizar bot√≥n de limpiar todos
      updateClearAllButton();

      // Aplicar filtros
      applyFilters();
    } catch (error) {
      console.error('Error loading services:', error);
      const container = document.getElementById('services-container');
      if (container) {
        container.innerHTML = `
          <div class="col-span-full text-center py-16">
            <p class="text-red-500 text-xl">Error al cargar los servicios</p>
          </div>
        `;
      }
    } finally {
      const loading = document.getElementById('loading');
      if (loading) loading.classList.add('hidden');
    }
  }

  // Inicializar categor√≠as y b√∫squeda desde URL
  function initializeCategoriesFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    const categoriesParam = urlParams.get('categories');
    const searchParam = urlParams.get('search');

    if (categoriesParam) {
      const categories = categoriesParam.split(',').filter(Boolean);
      selectedCategories = new Set(categories);
    }

    if (searchParam) {
      searchQuery = searchParam;
      const searchInput = document.getElementById('search-input') as HTMLInputElement;
      if (searchInput) {
        searchInput.value = searchQuery;
      }
    }
  }

  // Actualizar URL con categor√≠as seleccionadas y b√∫squeda
  function updateURL() {
    const url = new URL(window.location.href);

    if (selectedCategories.size > 0) {
      url.searchParams.set('categories', Array.from(selectedCategories).join(','));
    } else {
      url.searchParams.delete('categories');
    }

    if (searchQuery) {
      url.searchParams.set('search', searchQuery);
    } else {
      url.searchParams.delete('search');
    }

    window.history.pushState({}, '', url.toString());
  }

  // Renderizar checkboxes de categor√≠as
  function renderCategoryCheckboxes() {
    const container = document.getElementById('category-checkboxes');
    if (!container) return;

    container.innerHTML = availableCategories.map(category => `
      <label class="flex items-center gap-3 p-2.5 hover:bg-gray-700/50 rounded-lg cursor-pointer transition-all group">
        <input
          type="checkbox"
          value="${category}"
          ${selectedCategories.has(category) ? 'checked' : ''}
          class="category-checkbox w-4 h-4 text-[#82e256] bg-gray-700 border-gray-600 rounded focus:ring-[#82e256] focus:ring-2 cursor-pointer"
        />
        <span class="text-white text-sm flex-1 group-hover:text-[#82e256] transition-colors">${category}</span>
        ${selectedCategories.has(category) ? `
          <svg class="w-4 h-4 text-[#82e256]" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
          </svg>
        ` : ''}
      </label>
    `).join('');

    // Agregar event listeners
    document.querySelectorAll('.category-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', handleCategoryChange);
    });
  }

  // Manejar cambio de categor√≠a
  function handleCategoryChange(event: Event) {
    const checkbox = event.target as HTMLInputElement;
    const category = checkbox.value;

    if (checkbox.checked) {
      selectedCategories.add(category);
    } else {
      selectedCategories.delete(category);
    }

    updateURL();
    applyFilters();
    updateSelectedCategoriesDisplay();
    updateClearAllButton();
  }

  // Actualizar display de categor√≠as seleccionadas
  function updateSelectedCategoriesDisplay() {
    const container = document.getElementById('selected-categories-chips');
    const filterBadge = document.getElementById('filter-badge');

    if (!container || !filterBadge) return;

    if (selectedCategories.size === 0) {
      container.classList.add('hidden');
      container.innerHTML = '';
      filterBadge.classList.add('hidden');
    } else {
      container.classList.remove('hidden');
      filterBadge.classList.remove('hidden');
      filterBadge.textContent = selectedCategories.size.toString();

      container.innerHTML = Array.from(selectedCategories).map(category => `
        <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-[#82e256]/20 text-[#82e256] border border-[#82e256]/40 rounded-full text-xs font-semibold">
          ${category}
          <button
            class="remove-category hover:text-[#6bc73d] transition-colors"
            data-category="${category}"
          >
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </span>
      `).join('');

      // Agregar event listeners a los botones de remover
      document.querySelectorAll('.remove-category').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const button = (e.target as HTMLElement).closest('.remove-category') as HTMLElement;
          const category = button?.getAttribute('data-category');
          if (category) {
            selectedCategories.delete(category);
            updateURL();
            applyFilters();
            updateSelectedCategoriesDisplay();
            renderCategoryCheckboxes();
            updateClearAllButton();
          }
        });
      });
    }
  }

  // Aplicar filtros
  function applyFilters() {
    let filtered = allServices;

    // Filtrar por categor√≠as seleccionadas
    if (selectedCategories.size > 0) {
      filtered = filtered.filter(service =>
        selectedCategories.has(service.category)
      );
    }

    // Filtrar por texto de b√∫squeda
    if (searchQuery) {
      const query = searchQuery.toLowerCase();
      filtered = filtered.filter(service =>
        service.name.toLowerCase().includes(query) ||
        service.description.toLowerCase().includes(query) ||
        service.category.toLowerCase().includes(query)
      );
    }

    renderServices(filtered);
    updateResultsCount(filtered.length, 'servicios');
  }

  // Renderizar servicios
  function renderServices(services: any[]) {
    const container = document.getElementById('services-container');
    const noResults = document.getElementById('no-results');

    if (!container) return;

    if (services.length === 0) {
      container.innerHTML = '';
      noResults?.classList.remove('hidden');
      return;
    }

    noResults?.classList.add('hidden');

    container.innerHTML = services
      .map(
        (service) => `
      <article class="group bg-gray-800/50 rounded-xl overflow-hidden hover:transform hover:scale-105 transition-all duration-300 border border-gray-700 hover:border-[#82e256]">
        <!-- Header con icono -->
        <div class="relative bg-gradient-to-br from-[#00464e] to-[#006064] p-6 text-center">
          <div class="text-5xl mb-3">
            <span class="material-symbols-outlined text-[#82e256]" style="font-size: 3rem;">${getIconName(service.icon)}</span>
          </div>
          <div class="text-xs font-semibold text-white/80 bg-black/30 px-3 py-1 rounded-full inline-block">
            ${service.category || 'Servicio Profesional'}
          </div>
        </div>

        <!-- Contenido -->
        <div class="p-6">
          <h3 class="text-lg font-bold text-white mb-3 line-clamp-2 group-hover:text-[#82e256] transition-colors">
            ${service.name}
          </h3>

          <p class="text-gray-300 text-sm mb-4 line-clamp-3">
            ${service.description}
          </p>

          <!-- Botones de acci√≥n -->
          <div class="flex gap-2 pt-3 border-t border-gray-700">
            <button
              class="service-btn flex-1 text-xs font-semibold text-white bg-[#82e256] hover:bg-[#6bc73d] px-3 py-1.5 rounded-md transition-all hover:scale-105 flex items-center justify-center gap-1.5"
              data-service-id="${service.id}"
            >
              <span class="material-symbols-outlined" style="font-size: 14px;">chat</span>
              Consultar IA
            </button>
            <a
              href="/#contenido10"
              class="flex-1 text-xs font-semibold text-[#82e256] border border-[#82e256] hover:bg-[#82e256] hover:text-black px-3 py-1.5 rounded-md transition-all hover:scale-105 flex items-center justify-center gap-1.5"
            >
              <span class="material-symbols-outlined" style="font-size: 14px;">calendar_month</span>
              Agendar
            </a>
          </div>
        </div>
      </article>
    `
      )
      .join('');

    // Agregar event listeners a los botones
    document.querySelectorAll('.service-btn').forEach((btn) => {
      btn.addEventListener('click', function () {
        const serviceId = this.getAttribute('data-service-id');
        const service = services.find((s) => s.id == serviceId);
        if (service) {
          showServiceModal(service);
        }
      });
    });
  }

  // Mapear iconos de string a nombres de material symbols
  function getIconName(icon: string): string {
    const iconMap: Record<string, string> = {
      layers: 'layers',
      server: 'dns',
      cpu: 'memory',
      eye: 'visibility',
      code2: 'code',
      zap: 'bolt',
      database: 'database',
      docker: 'view_in_ar',
      box: 'inventory_2',
      robot: 'smart_toy',
      wifi: 'wifi',
      broadcast: 'podcasts',
      smartphone: 'smartphone',
      users: 'group',
      activity: 'monitoring',
      gauge: 'speed',
      shield: 'shield',
      table: 'table_chart',
      checkcircle: 'check_circle',
      scan: 'qr_code_scanner',
      linechart: 'show_chart',
      bell: 'notifications',
      folder: 'folder',
      lock: 'lock',
      barchart2: 'bar_chart',
      creditcard: 'credit_card',
      repeat: 'autorenew',
      layers2: 'layers',
      rocket: 'rocket_launch',
      sparkles: 'auto_awesome',
      cloud: 'cloud',
      api: 'api',
    };
    return iconMap[icon] || 'settings';
  }

  // Estado del chat
  let conversationHistory: any[] = [];
  let currentService: any = null;

  // Mostrar modal de servicio
  function showServiceModal(service: any) {
    currentService = service;
    conversationHistory = [];

    // Actualizar t√≠tulo del modal
    const modalTitle = document.getElementById('ai-modal-title');
    const modalSubtitle = document.getElementById('ai-modal-subtitle');

    if (modalTitle) modalTitle.textContent = service.name;
    if (modalSubtitle) modalSubtitle.textContent = 'Preg√∫ntame sobre este servicio';

    // Limpiar mensajes anteriores
    const chatMessages = document.getElementById('chat-messages');
    if (chatMessages) {
      chatMessages.innerHTML = `
        <div class="message-ai flex gap-3">
          <div class="flex-shrink-0">
            <span class="text-3xl">ü§ñ</span>
          </div>
          <div class="flex-1 bg-gray-800 rounded-2xl p-4">
            <p class="text-white">¬°Hola! üëã Soy una IA Tecnica virtual. Preguntame lo que quieras puedo ayudarte con informaci√≥n sobre <strong class="text-[#82e256]">${service.name}</strong>.</p>
            <p class="text-white mt-2">${service.description}</p>
            <p class="text-gray-400 text-sm mt-3">√≥ prefieres agendar una</p>
            <a href="/#contenido10" class="inline-flex items-center gap-2 mt-4 px-4 py-2 text-purple-400 font-semibold rounded-lg transition-all">
              <span class="material-symbols-outlined text-sm">calendar_month</span>
               asesor√≠a personalizada
            </a>
             <p class="text-gray-400 text-sm mt-3">PREGUNTAME Y TE ASESORO</p>
          </div>
        </div>
      `;
    }

    // Mostrar modal
    const modal = document.getElementById('ai-modal');
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    // Focus en el input
    setTimeout(() => {
      const chatInput = document.getElementById('chat-input') as HTMLInputElement;
      chatInput?.focus();
    }, 100);
  }

  // Cerrar modal
  function closeModal() {
    const modal = document.getElementById('ai-modal');
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
    currentService = null;
    conversationHistory = [];
  }

  // Agregar mensaje al chat
  function addMessage(content: string, isUser: boolean) {
    const chatMessages = document.getElementById('chat-messages');
    if (!chatMessages) return;

    const messageDiv = document.createElement('div');
    messageDiv.className = isUser ? 'message-user flex gap-3 justify-end' : 'message-ai flex gap-3';

    if (isUser) {
      messageDiv.innerHTML = `
        <div class="flex-1 bg-gradient-to-r from-[#82e256] to-[#6bc73d] rounded-2xl p-4 max-w-[80%]">
          <p class="text-black">${content}</p>
        </div>
        <div class="flex-shrink-0">
          <span class="text-3xl">üë§</span>
        </div>
      `;
    } else {
      messageDiv.innerHTML = `
        <div class="flex-shrink-0">
          <span class="text-3xl">ü§ñ</span>
        </div>
        <div class="flex-1 bg-gray-800 rounded-2xl p-4 max-w-[80%]">
          <div class="text-white">${content}</div>
        </div>
      `;
    }

    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // Enviar mensaje a la API
  async function sendMessage(question: string) {
    if (!question.trim() || !currentService) return;

    // Agregar mensaje del usuario
    addMessage(question, true);
    conversationHistory.push({ role: 'user', content: question });

    // Mostrar indicador de carga
    const chatMessages = document.getElementById('chat-messages');
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'message-ai flex gap-3';
    loadingDiv.id = 'loading-message';
    loadingDiv.innerHTML = `
      <div class="flex-shrink-0">
        <span class="text-3xl">ü§ñ</span>
      </div>
      <div class="flex-1 bg-gray-800 rounded-2xl p-4">
        <div class="flex items-center gap-2">
          <div class="animate-pulse">Pensando</div>
          <div class="flex gap-1">
            <div class="w-2 h-2 bg-[#82e256] rounded-full animate-bounce" style="animation-delay: 0ms"></div>
            <div class="w-2 h-2 bg-[#82e256] rounded-full animate-bounce" style="animation-delay: 150ms"></div>
            <div class="w-2 h-2 bg-[#82e256] rounded-full animate-bounce" style="animation-delay: 300ms"></div>
          </div>
        </div>
      </div>
    `;
    chatMessages?.appendChild(loadingDiv);
    chatMessages!.scrollTop = chatMessages!.scrollHeight;

    try {
      const response = await fetch('/api/chat-assistant.json', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          question,
          conversationHistory,
          serviceContext: {
            serviceName: currentService.name,
            serviceDescription: currentService.description
          }
        }),
      });

      const data = await response.json();

      // Eliminar indicador de carga
      loadingDiv.remove();

      if (data.success && data.response) {
        addMessage(data.response, false);
        conversationHistory.push({ role: 'assistant', content: data.response });
      } else {
        addMessage('Lo siento, hubo un error al procesar tu pregunta. Por favor, intenta de nuevo.', false);
      }
    } catch (error) {
      console.error('Error sending message:', error);
      loadingDiv.remove();
      addMessage('Lo siento, hubo un error de conexi√≥n. Por favor, verifica tu conexi√≥n e intenta de nuevo.', false);
    }
  }

  // Actualizar contador de resultados
  function updateResultsCount(count: number, type: 'servicios' | 'automatizaciones') {
    const counter = document.getElementById('results-count');
    const typeLabel = document.getElementById('results-type');
    if (counter) {
      counter.textContent = count.toString();
    }
    if (typeLabel) {
      typeLabel.textContent = type === 'servicios' ? 'servicios' : 'automatizaciones';
    }
  }

  // Variable para rastrear el tab actual
  let currentTab: 'servicios' | 'automatizaciones' = 'servicios';

  // Event listener para b√∫squeda de texto
  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const clearSearchBtn = document.getElementById('clear-search-btn');

  if (searchInput && clearSearchBtn) {
    searchInput.addEventListener('input', (e) => {
      searchQuery = (e.target as HTMLInputElement).value;

      // Mostrar/ocultar bot√≥n de limpiar
      if (searchQuery) {
        clearSearchBtn.classList.remove('hidden');
      } else {
        clearSearchBtn.classList.add('hidden');
      }

      updateURL();
      applyFilters();
      updateClearAllButton();
    });

    // Bot√≥n para limpiar b√∫squeda
    clearSearchBtn.addEventListener('click', () => {
      searchInput.value = '';
      searchQuery = '';
      clearSearchBtn.classList.add('hidden');
      updateURL();
      applyFilters();
      updateClearAllButton();
    });

    // Mostrar bot√≥n si hay texto inicial desde URL
    if (searchQuery) {
      clearSearchBtn.classList.remove('hidden');
    }
  }

  // Toggle filter dropdown
  const filterToggleBtn = document.getElementById('filter-toggle-btn');
  const filterDropdown = document.getElementById('filter-dropdown');
  const applyFiltersBtn = document.getElementById('apply-filters-btn');

  if (filterToggleBtn && filterDropdown) {
    filterToggleBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const isHidden = filterDropdown.classList.contains('hidden');

      if (isHidden) {
        filterDropdown.classList.remove('hidden');
        // Trigger reflow para la animaci√≥n
        void filterDropdown.offsetWidth;
      } else {
        filterDropdown.classList.add('hidden');
      }
    });

    // Cerrar dropdown al hacer clic fuera
    document.addEventListener('click', (e) => {
      if (!filterToggleBtn.contains(e.target as Node) && !filterDropdown.contains(e.target as Node)) {
        filterDropdown.classList.add('hidden');
      }
    });

    // Bot√≥n "Aplicar filtros" cierra el dropdown
    if (applyFiltersBtn) {
      applyFiltersBtn.addEventListener('click', () => {
        filterDropdown.classList.add('hidden');
      });
    }

    // Cerrar con tecla ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !filterDropdown.classList.contains('hidden')) {
        filterDropdown.classList.add('hidden');
      }
    });
  }

  // Limpiar todas las categor√≠as
  const clearCategoriesBtn = document.getElementById('clear-categories');
  if (clearCategoriesBtn) {
    clearCategoriesBtn.addEventListener('click', () => {
      selectedCategories.clear();
      updateURL();
      applyFilters();
      updateSelectedCategoriesDisplay();
      renderCategoryCheckboxes();
      updateClearAllButton();
    });
  }

  // Limpiar todos los filtros (b√∫squeda + categor√≠as)
  const clearAllFiltersBtn = document.getElementById('clear-all-filters');
  if (clearAllFiltersBtn) {
    clearAllFiltersBtn.addEventListener('click', () => {
      // Limpiar b√∫squeda
      if (searchInput) {
        searchInput.value = '';
        searchQuery = '';
      }
      if (clearSearchBtn) {
        clearSearchBtn.classList.add('hidden');
      }

      // Limpiar categor√≠as
      selectedCategories.clear();

      // Actualizar
      updateURL();
      applyFilters();
      updateSelectedCategoriesDisplay();
      renderCategoryCheckboxes();
      updateClearAllButton();
    });
  }

  // Actualizar visibilidad del bot√≥n "Limpiar todos los filtros"
  function updateClearAllButton() {
    const clearAllBtn = document.getElementById('clear-all-filters');
    if (!clearAllBtn) return;

    const hasFilters = searchQuery || selectedCategories.size > 0;

    if (hasFilters) {
      clearAllBtn.classList.remove('hidden');
    } else {
      clearAllBtn.classList.add('hidden');
    }
  }

  // Event listeners para el modal
  const closeModalBtn = document.getElementById('close-ai-modal');
  if (closeModalBtn) {
    closeModalBtn.addEventListener('click', closeModal);
  }

  // Cerrar modal al hacer clic fuera de √©l
  const aiModal = document.getElementById('ai-modal');
  if (aiModal) {
    aiModal.addEventListener('click', (e) => {
      if (e.target === aiModal) {
        closeModal();
      }
    });
  }

  // Event listener para el formulario de chat
  const chatForm = document.getElementById('chat-form');
  if (chatForm) {
    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const chatInput = document.getElementById('chat-input') as HTMLInputElement;
      if (chatInput && chatInput.value.trim()) {
        const question = chatInput.value.trim();
        chatInput.value = '';
        await sendMessage(question);
      }
    });
  }

  // Cargar servicios al iniciar
  loadServices();

  // ===== TABS LOGIC =====
  const tabServiciosBtn = document.getElementById('tab-servicios');
  const tabAutomatizacionesBtn = document.getElementById('tab-automatizaciones');
  const contentServicios = document.getElementById('content-servicios');
  const contentAutomatizaciones = document.getElementById('content-automatizaciones');
  const sectionFiltros = document.getElementById('section-filtros');

  function switchTab(tab: 'servicios' | 'automatizaciones') {
    currentTab = tab;

    if (tab === 'servicios') {
      // Activar tab servicios
      tabServiciosBtn?.classList.add('active', 'bg-[#82e256]', 'text-black');
      tabServiciosBtn?.classList.remove('bg-white/10', 'text-white');
      tabAutomatizacionesBtn?.classList.remove('active', 'bg-[#82e256]', 'text-black');
      tabAutomatizacionesBtn?.classList.add('bg-white/10', 'text-white');

      // Mostrar contenido servicios
      contentServicios?.classList.remove('hidden');
      contentAutomatizaciones?.classList.add('hidden');
      sectionFiltros?.classList.remove('hidden');

      // Actualizar contador
      const query = searchInput?.value.toLowerCase() || '';
      const filtered = filterServices(query);
      updateResultsCount(filtered.length, 'servicios');
    } else {
      // Activar tab automatizaciones
      tabAutomatizacionesBtn?.classList.add('active', 'bg-[#82e256]', 'text-black');
      tabAutomatizacionesBtn?.classList.remove('bg-white/10', 'text-white');
      tabServiciosBtn?.classList.remove('active', 'bg-[#82e256]', 'text-black');
      tabServiciosBtn?.classList.add('bg-white/10', 'text-white');

      // Mostrar contenido automatizaciones
      contentAutomatizaciones?.classList.remove('hidden');
      contentServicios?.classList.add('hidden');
      sectionFiltros?.classList.remove('hidden');

      // Renderizar workflows si a√∫n no se han cargado
      if (!workflowsLoaded) {
        renderWorkflows(workflows);
        workflowsLoaded = true;
      }

      // Actualizar contador
      const query = searchInput?.value.toLowerCase() || '';
      const filtered = filterWorkflows(query);
      updateResultsCount(filtered.length, 'automatizaciones');
    }
  }

  tabServiciosBtn?.addEventListener('click', () => switchTab('servicios'));
  tabAutomatizacionesBtn?.addEventListener('click', () => switchTab('automatizaciones'));

  // ===== WORKFLOWS DATA & LOGIC =====
  let workflowsLoaded = false;

  const workflows = [
    {
      id: 1,
      title: "Chatbot WhatsApp con IA y RAG",
      description: "Asistente inteligente 24/7 para WhatsApp con memoria contextual y b√∫squeda en base de conocimiento vectorial. Responde preguntas de clientes usando documentaci√≥n empresarial.",
      category: "Atenci√≥n al Cliente",
      features: ["Integraci√≥n WhatsApp Business API", "Base de datos vectorial (Qdrant)", "Memoria de conversaci√≥n por usuario", "Respuestas personalizadas con GPT-4", "B√∫squeda sem√°ntica en documentos"],
      tech: ["n8n", "OpenAI GPT-4", "Qdrant", "WhatsApp API"],
      roi: "70% menos tiempo de respuesta (Chatbot inteligente disponible 24/7 con memoria contextual)",
      difficulty: "Intermedio"
    },
    {
      id: 2,
      title: "Agente IA con Herramientas y Memoria",
      description: "Agente conversacional con capacidades extendidas: consulta clima, b√∫squeda web, c√°lculos matem√°ticos y memoria persistente de sesiones.",
      category: "Asistentes Virtuales",
      features: ["Herramienta de clima en tiempo real", "B√∫squeda web con SerpAPI", "Calculadora matem√°tica avanzada", "Memoria de conversaci√≥n (15 mensajes)", "Guardado en base de datos PostgreSQL"],
      tech: ["n8n", "OpenAI GPT-4", "SerpAPI", "PostgreSQL"],
      roi: "90% consultas repetitivas automatizadas (Agente IA con herramientas y memoria persistente)",
      difficulty: "Avanzado"
    },
    {
      id: 3,
      title: "Soporte al Cliente Automatizado",
      description: "Sistema completo de atenci√≥n al cliente con an√°lisis de sentimiento, priorizaci√≥n autom√°tica, b√∫squeda en base de conocimiento y respuestas personalizadas por IA.",
      category: "Atenci√≥n al Cliente",
      features: ["An√°lisis de sentimiento con IA", "Priorizaci√≥n autom√°tica de tickets", "Consulta historial y perfil del cliente", "Base de conocimiento vectorial", "Alertas a equipo si sentimiento negativo", "Notificaciones multi-canal (Email, Slack)"],
      tech: ["n8n", "OpenAI GPT-4", "Qdrant", "PostgreSQL", "Gmail", "Slack"],
      roi: "80% reducci√≥n de carga manual (Priorizaci√≥n autom√°tica y an√°lisis de sentimiento con IA)",
      difficulty: "Avanzado"
    },
    {
      id: 4,
      title: "Recuperaci√≥n de Carritos Abandonados",
      description: "Estrategia multi-canal para recuperar ventas perdidas con emails personalizados por IA, SMS y WhatsApp. Descuentos inteligentes basados en valor del carrito.",
      category: "E-commerce",
      features: ["Email personalizado con GPT-4 (1 hora)", "SMS con urgencia (3 horas)", "WhatsApp con video de productos (24 horas)", "Descuentos din√°micos seg√∫n valor", "C√≥digos √∫nicos con expiraci√≥n", "Tracking completo de env√≠os"],
      tech: ["n8n", "OpenAI GPT-4", "Gmail", "Twilio", "WhatsApp", "PostgreSQL"],
      roi: "25-40% m√°s conversiones (Recomendaciones y promociones automatizadas por IA)",
      difficulty: "Intermedio"
    },
    {
      id: 5,
      title: "Gesti√≥n Inteligente de Documentos",
      description: "Sistema RAG completo para upload, procesamiento y consulta de documentos empresariales con IA.",
      category: "Gesti√≥n Documental",
      features: ["Upload y procesamiento autom√°tico", "Extracci√≥n de texto con OCR", "Indexaci√≥n en base vectorial", "Sistema de preguntas y respuestas", "B√∫squeda sem√°ntica avanzada"],
      tech: ["n8n", "OpenAI Embeddings", "Qdrant", "LangChain"],
      roi: "90% reducci√≥n en b√∫squeda manual (Indexaci√≥n vectorial y b√∫squeda sem√°ntica inteligente)",
      difficulty: "Avanzado"
    },
    {
      id: 6,
      title: "Campa√±as de Email Marketing con IA",
      description: "Automatizaci√≥n completa de campa√±as de email con contenido generado por IA, segmentaci√≥n inteligente y seguimiento de m√©tricas.",
      category: "Marketing",
      features: ["Generaci√≥n de contenido con IA", "Segmentaci√≥n de audiencias", "Personalizaci√≥n por usuario", "A/B testing autom√°tico", "An√°lisis de tasas de apertura/clics"],
      tech: ["n8n", "OpenAI GPT-4", "Gmail/SendGrid", "PostgreSQL"],
      roi: "35% mejora en engagement (Segmentaci√≥n inteligente y personalizaci√≥n con IA)",
      difficulty: "Intermedio"
    },
    {
      id: 7,
      title: "Lead Generation en LinkedIn",
      description: "Automatizaci√≥n de prospecci√≥n en LinkedIn con mensajes personalizados generados por IA y seguimiento autom√°tico.",
      category: "Ventas",
      features: ["B√∫squeda autom√°tica de prospectos", "Mensajes personalizados con IA", "Seguimiento de interacciones", "Calificaci√≥n de leads", "Integraci√≥n con CRM"],
      tech: ["n8n", "LinkedIn API", "OpenAI GPT-4", "PostgreSQL"],
      roi: "3x m√°s leads calificados (Prospecci√≥n y mensajes personalizados por IA)",
      difficulty: "Avanzado"
    },
    {
      id: 8,
      title: "Automatizaci√≥n de Propuestas Upwork",
      description: "Sistema que detecta proyectos relevantes en Upwork y genera propuestas personalizadas usando IA bas√°ndose en tu perfil.",
      category: "Freelancing",
      features: ["Scraping de proyectos Upwork", "Filtrado por keywords y presupuesto", "Generaci√≥n de propuestas con IA", "Personalizaci√≥n basada en portfolio", "Env√≠o autom√°tico (opcional)"],
      tech: ["n8n", "Upwork API", "OpenAI GPT-4", "Web Scraping"],
      roi: "5x m√°s propuestas enviadas (Generaci√≥n y env√≠o autom√°tico con IA)",
      difficulty: "Intermedio"
    },
    {
      id: 9,
      title: "Gesti√≥n de Redes Sociales Multi-plataforma",
      description: "Publica contenido simult√°neamente en m√∫ltiples plataformas con contenido generado y optimizado por IA para cada red social.",
      category: "Marketing",
      features: ["Publicaci√≥n multi-canal (Twitter, LinkedIn, Instagram)", "Adaptaci√≥n de contenido por red social", "Generaci√≥n de hashtags con IA", "Programaci√≥n de posts", "An√°lisis de engagement"],
      tech: ["n8n", "OpenAI GPT-4", "Twitter API", "LinkedIn API", "Instagram API"],
      roi: "70% ahorro de tiempo (Contenido adaptado y publicaci√≥n multi-canal autom√°tica)",
      difficulty: "Intermedio"
    },
    {
      id: 10,
      title: "Web Scraping y Enriquecimiento de Datos",
      description: "Extrae datos de sitios web y enriqu√©celos con IA para obtener insights, clasificaciones y an√°lisis de mercado.",
      category: "Data Intelligence",
      features: ["Scraping autom√°tico programado", "Limpieza de datos con IA", "Clasificaci√≥n y categorizaci√≥n", "Detecci√≥n de cambios", "An√°lisis de tendencias"],
      tech: ["n8n", "Cheerio/Puppeteer", "OpenAI GPT-4", "PostgreSQL"],
      roi: "Ahorro de 20h/semana (Scraping autom√°tico y an√°lisis de datos con IA)",
      difficulty: "Avanzado"
    },
    {
      id: 11,
      title: "Creaci√≥n de Contenido con IA",
      description: "Generaci√≥n masiva de contenido optimizado SEO: blogs, posts sociales, scripts de video, newsletters y m√°s.",
      category: "Marketing",
      features: ["Generaci√≥n de art√≠culos largos", "Optimizaci√≥n SEO autom√°tica", "Creaci√≥n de meta descriptions", "Generaci√≥n de im√°genes con DALL-E", "Publicaci√≥n autom√°tica en CMS"],
      tech: ["n8n", "OpenAI GPT-4", "DALL-E", "WordPress API"],
      roi: "10x velocidad de producci√≥n (Contenido SEO generado autom√°ticamente con IA)",
      difficulty: "Intermedio"
    },
    {
      id: 12,
      title: "Notificaciones Inteligentes Multi-Canal",
      description: "Sistema centralizado de notificaciones que selecciona el canal √≥ptimo (Email, SMS, WhatsApp, Slack) seg√∫n urgencia y preferencias.",
      category: "Comunicaci√≥n",
      features: ["Enrutamiento inteligente por urgencia", "Preferencias personalizadas por usuario", "Fallback autom√°tico entre canales", "Consolidaci√≥n de notificaciones", "Analytics de entrega"],
      tech: ["n8n", "Twilio", "WhatsApp", "Gmail", "Slack", "OpenAI"],
      roi: "40% mejor tasa de respuesta a notificaciones importantes",
      difficulty: "Avanzado"
    },
    {
      id: 13,
      title: "Onboarding Automatizado de Empleados",
      description: "Automatiza todo el proceso de incorporaci√≥n: creaci√≥n de cuentas, asignaci√≥n de equipos, capacitaciones, documentaci√≥n y seguimiento personalizado del nuevo empleado.",
      category: "Talento Humano",
      features: ["Creaci√≥n autom√°tica de cuentas (Email, Slack, CRM)", "Env√≠o de documentaci√≥n y contratos", "Programaci√≥n de capacitaciones", "Checklist interactivo de onboarding", "Seguimiento a 30/60/90 d√≠as", "Encuestas de satisfacci√≥n automatizadas"],
      tech: ["n8n", "Google Workspace", "Slack", "BambooHR", "DocuSign", "OpenAI"],
      roi: "85% reducci√≥n tiempo administrativo en onboarding",
      difficulty: "Intermedio"
    },
    {
      id: 14,
      title: "Reclutamiento Inteligente con IA",
      description: "Sistema de ATS (Applicant Tracking System) potenciado con IA que filtra CVs, agenda entrevistas, eval√∫a candidatos y genera procesos completos de entrevista genera reportes de selecci√≥n.",
      category: "Talento Humano",
      features: ["Parsing de CVs con IA", "Scoring autom√°tico de candidatos", "Detecci√≥n de habilidades y experiencia", "Programaci√≥n inteligente de entrevistas", "Generaci√≥n de preguntas personalizadas", "Res√∫menes de candidatos con GPT-4"],
      tech: ["n8n", "OpenAI GPT-4", "Calendly", "LinkedIn API", "PostgreSQL"],
      roi: "60% reducci√≥n tiempo de selecci√≥n al filtrar candidatos autom√°ticamente y generar con IA entrevistas",
      difficulty: "Avanzado"
    },
    {
      id: 15,
      title: "Evaluaciones de Desempe√±o Automatizadas",
      description: "Recolecta feedback 360¬∞, analiza desempe√±o con IA, genera reportes personalizados y programa reuniones de retroalimentaci√≥n autom√°ticamente.",
      category: "Talento Humano",
      features: ["Env√≠o autom√°tico de encuestas 360¬∞", "An√°lisis de sentimiento en comentarios", "Generaci√≥n de reportes personalizados", "Identificaci√≥n de fortalezas/√°reas de mejora", "Recomendaciones de desarrollo con IA", "Dashboard de m√©tricas de equipo"],
      tech: ["n8n", "OpenAI GPT-4", "Google Forms", "Tableau", "PostgreSQL"],
      roi: "70% ahorro en tiempo de HR al evaluar desempe√±o constantemente",
      difficulty: "Intermedio"
    },
    {
      id: 16,
      title: "Gesti√≥n de Vacaciones y Ausencias",
      description: "Automatiza solicitudes, aprobaciones, detecci√≥n de conflictos de cobertura y actualizaci√≥n de calendarios compartidos con notificaciones inteligentes.",
      category: "Talento Humano",
      features: ["Solicitud y aprobaci√≥n v√≠a chat/email", "Validaci√≥n de disponibilidad de equipo", "Detecci√≥n de conflictos con IA", "Actualizaci√≥n autom√°tica de calendarios", "C√°lculo de d√≠as disponibles", "Notificaciones a stakeholders"],
      tech: ["n8n", "Google Calendar", "Slack", "PostgreSQL", "OpenAI"],
      roi: "50% reducci√≥n aprobaciones manuales al iniciar procesos automatizables",
      difficulty: "B√°sico"
    },
    {
      id: 17,
      title: "Encuestas de Clima Laboral con An√°lisis IA",
      description: "Encuestas peri√≥dicas automatizadas con an√°lisis de sentimiento, detecci√≥n de tendencias y alertas tempranas de problemas organizacionales.",
      category: "Talento Humano",
      features: ["Env√≠o programado de encuestas", "An√°lisis de sentimiento por departamento", "Detecci√≥n de riesgos de rotaci√≥n", "Identificaci√≥n de temas recurrentes", "Generaci√≥n de planes de acci√≥n con IA", "Benchmarking hist√≥rico"],
      tech: ["n8n", "OpenAI GPT-4", "Typeform", "Slack", "PostgreSQL"],
      roi: "30% reducci√≥n en rotaci√≥n",
      difficulty: "Intermedio"
    },
    {
      id: 18,
      title: "Capacitaci√≥n Personalizada con IA",
      description: "Recomienda cursos y contenido de capacitaci√≥n basado en gaps de habilidades, objetivos de carrera y an√°lisis de desempe√±o usando IA.",
      category: "Talento Humano",
      features: ["An√°lisis de skill gaps con IA", "Recomendaciones personalizadas de cursos", "Programaci√≥n autom√°tica de capacitaciones", "Seguimiento de progreso", "Certificaciones autom√°ticas", "Rutas de aprendizaje adaptativas"],
      tech: ["n8n", "OpenAI GPT-4", "Udemy API", "LinkedIn Learning", "PostgreSQL"],
      roi: "3x aumento en capacitaciones completadas",
      difficulty: "Avanzado"
    },
    {
      id: 19,
      title: "Inspecci√≥n de Calidad con Computer Vision",
      description: "Sistema automatizado de control de calidad visual usando IA para detectar defectos en productos, generar reportes y alertar sobre anomal√≠as.",
      category: "Calidad",
      features: ["Detecci√≥n de defectos con Computer Vision", "Clasificaci√≥n autom√°tica de severidad", "Generaci√≥n de reportes de no conformidad", "Alertas en tiempo real a supervisores", "An√°lisis de tendencias de defectos", "Dashboard de m√©tricas de calidad"],
      tech: ["n8n", "OpenAI Vision", "TensorFlow", "PostgreSQL", "Slack"],
      roi: "95% precisi√≥n en detecci√≥n",
      difficulty: "Avanzado"
    },
    {
      id: 20,
      title: "Gesti√≥n de No Conformidades (NCR)",
      description: "Automatiza el ciclo completo de no conformidades: registro, asignaci√≥n, seguimiento, an√°lisis de causa ra√≠z con IA y cierre de acciones correctivas.",
      category: "Calidad",
      features: ["Registro autom√°tico desde m√∫ltiples fuentes", "Clasificaci√≥n y priorizaci√≥n con IA", "Asignaci√≥n inteligente de responsables", "An√°lisis de causa ra√≠z con GPT-4", "Seguimiento de acciones correctivas", "Reportes de tendencias y KPIs"],
      tech: ["n8n", "OpenAI GPT-4", "Jira", "PostgreSQL", "Slack"],
      roi: "65% reducci√≥n tiempo de cierre",
      difficulty: "Intermedio"
    },
    {
      id: 21,
      title: "Auditor√≠as Internas Automatizadas",
      description: "Programaci√≥n, ejecuci√≥n y seguimiento de auditor√≠as con checklists inteligentes, generaci√≥n de hallazgos y planes de acci√≥n autom√°ticos.",
      category: "Calidad",
      features: ["Programaci√≥n autom√°tica de auditor√≠as", "Checklists inteligentes por proceso", "Captura de evidencias (fotos, documentos)", "Generaci√≥n autom√°tica de hallazgos", "Planes de acci√≥n con IA", "Seguimiento hasta cierre"],
      tech: ["n8n", "OpenAI GPT-4", "Google Drive", "PostgreSQL", "Teams"],
      roi: "80% ahorro tiempo preparaci√≥n",
      difficulty: "Intermedio"
    },
    {
      id: 22,
      title: "Control de Documentaci√≥n ISO",
      description: "Gesti√≥n autom√°tica de documentos normativos: control de versiones, notificaciones de revisi√≥n, aprobaciones y distribuci√≥n controlada.",
      category: "Calidad",
      features: ["Control de versiones autom√°tico", "Workflow de aprobaciones", "Notificaciones de documentos obsoletos", "Distribuci√≥n controlada por roles", "Registro de capacitaci√≥n en documentos", "Auditor√≠a completa de cambios"],
      tech: ["n8n", "SharePoint", "DocuSign", "PostgreSQL", "Email"],
      roi: "90% reducci√≥n documentos obsoletos",
      difficulty: "B√°sico"
    },
    {
      id: 23,
      title: "An√°lisis de Quejas de Clientes con IA",
      description: "Analiza quejas y reclamos usando NLP, clasifica por tipo, detecta patrones recurrentes y genera acciones preventivas autom√°ticamente.",
      category: "Calidad",
      features: ["Clasificaci√≥n autom√°tica de quejas", "An√°lisis de sentimiento y urgencia", "Detecci√≥n de problemas recurrentes", "Generaci√≥n de informes ejecutivos", "Recomendaciones de mejora con IA", "Alertas de tendencias negativas"],
      tech: ["n8n", "OpenAI GPT-4", "Zendesk", "PostgreSQL", "Tableau"],
      roi: "55% mejora en tiempo de respuesta",
      difficulty: "Avanzado"
    },
    {
      id: 24,
      title: "Conciliaci√≥n Bancaria Automatizada",
      description: "Importa extractos bancarios, concilia autom√°ticamente con registros contables, detecta discrepancias y genera reportes de conciliaci√≥n.",
      category: "Financiera",
      features: ["Import autom√°tico de extractos bancarios", "Matching inteligente con contabilidad", "Detecci√≥n de discrepancias con IA", "Clasificaci√≥n de transacciones", "Reportes de conciliaci√≥n autom√°ticos", "Alertas de partidas sin conciliar"],
      tech: ["n8n", "OpenAI GPT-4", "Plaid", "QuickBooks", "PostgreSQL"],
      roi: "90% reducci√≥n tiempo conciliaci√≥n",
      difficulty: "Avanzado"
    },
    {
      id: 25,
      title: "Gesti√≥n de Facturas y Cuentas por Pagar",
      description: "OCR de facturas, validaci√≥n autom√°tica, workflow de aprobaciones, programaci√≥n de pagos y alertas de vencimientos.",
      category: "Financiera",
      features: ["OCR extracci√≥n de datos de facturas", "Validaci√≥n contra √≥rdenes de compra", "Workflow de aprobaciones por monto", "Detecci√≥n de facturas duplicadas", "Programaci√≥n de pagos", "Dashboard de aging de cuentas"],
      tech: ["n8n", "OpenAI Vision", "DocuSign", "QuickBooks", "PostgreSQL"],
      roi: "75% reducci√≥n procesamiento manual",
      difficulty: "Intermedio"
    },
    {
      id: 26,
      title: "Cobranza Inteligente Automatizada",
      description: "Seguimiento autom√°tico de cuentas por cobrar con mensajes personalizados, escalaci√≥n inteligente y predicci√≥n de riesgo de morosidad.",
      category: "Financiera",
      features: ["Recordatorios autom√°ticos escalonados", "Mensajes personalizados con IA", "Predicci√≥n de riesgo de mora", "Escalaci√≥n autom√°tica por antig√ºedad", "Reportes de cartera vencida", "Integraci√≥n con WhatsApp/Email/SMS"],
      tech: ["n8n", "OpenAI GPT-4", "Twilio", "WhatsApp", "PostgreSQL"],
      roi: "40% mejora en recuperaci√≥n de cartera",
      difficulty: "Intermedio"
    },
    {
      id: 27,
      title: "Reportes Financieros Automatizados",
      description: "Genera reportes financieros (P&L, Balance, Cash Flow) autom√°ticamente con an√°lisis inteligente, insights y visualizaciones.",
      category: "Financiera",
      features: ["Generaci√≥n autom√°tica de estados financieros", "An√°lisis de variaciones con IA", "Detecci√≥n de anomal√≠as financieras", "Insights y recomendaciones", "Visualizaciones interactivas", "Distribuci√≥n programada a stakeholders"],
      tech: ["n8n", "OpenAI GPT-4", "QuickBooks", "Power BI", "PostgreSQL"],
      roi: "95% ahorro tiempo en reporteo",
      difficulty: "Avanzado"
    },
    {
      id: 28,
      title: "Detecci√≥n de Fraude Financiero",
      description: "Monitorea transacciones en tiempo real, detecta patrones sospechosos con ML, alerta sobre posibles fraudes y genera casos de investigaci√≥n.",
      category: "Financiera",
      features: ["Monitoreo en tiempo real de transacciones", "Detecci√≥n de patrones an√≥malos con ML", "Scoring de riesgo por transacci√≥n", "Alertas autom√°ticas a equipo de seguridad", "Creaci√≥n de casos de investigaci√≥n", "Dashboard de riesgos"],
      tech: ["n8n", "OpenAI", "TensorFlow", "PostgreSQL", "Slack"],
      roi: "85% detecci√≥n temprana de fraudes",
      difficulty: "Avanzado"
    },
    {
      id: 29,
      title: "Presupuesto y Forecast con IA",
      description: "Genera presupuestos autom√°ticos basados en hist√≥ricos, tendencias y variables externas. Forecasting inteligente con modelos predictivos.",
      category: "Financiera",
      features: ["An√°lisis de tendencias hist√≥ricas", "Forecasting con modelos ML", "Simulaciones de escenarios", "Ajustes autom√°ticos por estacionalidad", "Comparaci√≥n budget vs actual", "Alertas de desviaciones significativas"],
      tech: ["n8n", "OpenAI GPT-4", "Prophet", "PostgreSQL", "Excel API"],
      roi: "30% mejora en precisi√≥n de forecast",
      difficulty: "Avanzado"
    },
    {
      id: 30,
      title: "Optimizaci√≥n de Stock con IA",
      description: "Predicci√≥n de demanda con ML, c√°lculo autom√°tico de puntos de reorden, alertas de stock bajo y optimizaci√≥n de niveles de inventario.",
      category: "Inventarios",
      features: ["Predicci√≥n de demanda con ML", "C√°lculo din√°mico de punto de reorden", "Alertas de stock bajo/alto", "Optimizaci√≥n de niveles por SKU", "An√°lisis de rotaci√≥n de inventario", "Recomendaciones de compra inteligentes"],
      tech: ["n8n", "OpenAI", "Prophet", "PostgreSQL", "Slack"],
      roi: "45% reducci√≥n en quiebres de stock",
      difficulty: "Avanzado"
    },
    {
      id: 31,
      title: "Gesti√≥n de √ìrdenes de Compra Automatizada",
      description: "Genera √≥rdenes de compra autom√°ticamente basadas en niveles de inventario, env√≠a a proveedores y hace seguimiento hasta recepci√≥n.",
      category: "Inventarios",
      features: ["Generaci√≥n autom√°tica de OC", "Selecci√≥n inteligente de proveedores", "Env√≠o autom√°tico de √≥rdenes", "Seguimiento de entregas", "Alertas de retrasos", "Registro de recepciones"],
      tech: ["n8n", "OpenAI GPT-4", "Email", "PostgreSQL", "SAP API"],
      roi: "70% reducci√≥n tiempo de compras",
      difficulty: "Intermedio"
    },
    {
      id: 32,
      title: "Inventario C√≠clico Automatizado",
      description: "Programa conteos c√≠clicos basados en criticidad ABC, asigna tareas, registra conteos y ajusta autom√°ticamente discrepancias menores.",
      category: "Inventarios",
      features: ["Programaci√≥n inteligente por clasificaci√≥n ABC", "Asignaci√≥n autom√°tica de conteos", "App m√≥vil para registro", "Ajuste autom√°tico de diferencias menores", "An√°lisis de causas de discrepancias", "Dashboard de precisi√≥n de inventario"],
      tech: ["n8n", "Mobile App", "PostgreSQL", "OpenAI GPT-4", "Slack"],
      roi: "85% mejora en precisi√≥n",
      difficulty: "Intermedio"
    },
    {
      id: 33,
      title: "Picking y Packing Inteligente",
      description: "Optimiza rutas de picking con IA, genera listas inteligentes, valida con computer vision y automatiza etiquetado de env√≠os.",
      category: "Inventarios",
      features: ["Optimizaci√≥n de rutas de picking con IA", "Agrupaci√≥n inteligente de pedidos", "Validaci√≥n visual de productos", "Generaci√≥n autom√°tica de etiquetas", "Integraci√≥n con carriers", "Seguimiento de productividad"],
      tech: ["n8n", "OpenAI", "Computer Vision", "Shippo API", "PostgreSQL"],
      roi: "50% aumento en productividad",
      difficulty: "Avanzado"
    }
  ];

  function renderWorkflows(workflowsToRender: any[]) {
    const container = document.getElementById('workflows-container');
    if (!container) return;

    if (workflowsToRender.length === 0) {
      container.innerHTML = `
        <div class="col-span-full text-center py-16">
          <div class="text-gray-400 text-xl mb-4">No se encontraron automatizaciones</div>
          <button
            onclick="document.getElementById('search-input').value = ''; document.getElementById('search-input').dispatchEvent(new Event('input'));"
            class="text-[#82e256] hover:text-[#6bc73d] transition-colors"
          >
            Limpiar b√∫squeda
          </button>
        </div>
      `;
      return;
    }

    container.innerHTML = workflowsToRender.map((workflow, index) => `
      <div class="workflow-card bg-white/5 backdrop-blur border border-white/10 rounded-xl p-6 hover:border-[#82e256] transition-all duration-300 hover:shadow-[0_0_30px_rgba(130,226,86,0.3)]">
        <div class="flex items-start justify-between mb-4">
          <div class="text-5xl">${workflow.icon}</div>
          <span class="text-xs px-3 py-1 rounded-full bg-[#82e256]/20 text-[#82e256] font-semibold">
            ${workflow.category}
          </span>
        </div>
        <h3 class="text-2xl font-bold text-white mb-3">${workflow.title}</h3>
        <p class="text-gray-300 mb-4 leading-relaxed">${workflow.description}</p>
        <div class="mb-4">
          <h4 class="text-sm font-semibold text-[#82e256] mb-2">Caracter√≠sticas:</h4>
          <ul class="space-y-1">
            ${workflow.features.map(feature => `
              <li class="text-sm text-gray-400 flex items-start">
                <span class="text-[#82e256] mr-2">‚úì</span>
                <span>${feature}</span>
              </li>
            `).join('')}
          </ul>
        </div>
        <div class="mb-4">
          <h4 class="text-sm font-semibold text-[#82e256] mb-2">Tecnolog√≠as:</h4>
          <div class="flex flex-wrap gap-2">
            ${workflow.tech.map(tech => `
              <span class="text-xs px-2 py-1 bg-white/10 rounded text-gray-300">${tech}</span>
            `).join('')}
          </div>
        </div>
        <div class="border-t border-white/10 pt-4 mt-4 flex justify-between items-center">
          <div>
            <p class="text-xs text-gray-500 mb-1">ROI Estimado</p>
            <p class="text-sm font-semibold text-[#82e256]">${workflow.roi}</p>
          </div>
          <div class="text-right">
            <p class="text-xs text-gray-500 mb-1">Dificultad</p>
            <p class="text-sm font-semibold ${
              workflow.difficulty === 'Avanzado' ? 'text-red-400' :
              workflow.difficulty === 'Intermedio' ? 'text-yellow-400' :
              'text-green-400'
            }">${workflow.difficulty}</p>
          </div>
        </div>
        <a href="/#contenido10" class="mt-4 block w-full py-3 bg-gradient-to-r from-[#00464e] to-[#006417] text-white rounded-lg hover:from-[#006417] hover:to-[#82e256] transition-all duration-300 font-semibold text-center">
          Implementar Flujo
        </a>
      </div>
    `).join('');
  }
</script>

<style>
  .tab-button {
    background: rgba(255, 255, 255, 0.1);
    color: white;
  }

  .tab-button.active {
    background: #82e256;
    color: black;
  }

  .tab-button:hover {
    transform: scale(1.05);
  }
</style>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Color personalizado para el header del dropdown */
  .bg-gray-750 {
    background-color: #2d3748;
  }

  /* Animaci√≥n suave para el dropdown */
  #filter-dropdown {
    animation: slideDown 0.2s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Estilo para checkboxes */
  .category-checkbox:checked {
    background-color: #82e256;
    border-color: #82e256;
  }

  /* Scrollbar personalizada para el dropdown */
  #category-checkboxes::-webkit-scrollbar {
    width: 6px;
  }

  #category-checkboxes::-webkit-scrollbar-track {
    background: #1a1a1a;
    border-radius: 3px;
  }

  #category-checkboxes::-webkit-scrollbar-thumb {
    background: #4a5568;
    border-radius: 3px;
  }

  #category-checkboxes::-webkit-scrollbar-thumb:hover {
    background: #82e256;
  }
</style>
